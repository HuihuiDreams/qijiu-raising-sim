<!DOCTYPE html>
<html class="dark" lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>宿命轮回 - Fate Reincarnation</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
        href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&family=Noto+Serif+SC:wght@400;500;700;900&family=Noto+Sans+SC:wght@300;400;500;700;900&family=Space+Grotesk:wght@400;500;700&family=Newsreader:ital,opsz,wght@0,6..72,200..800;1,6..72,200..800&family=Inter:wght@400;500;700;900&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "vermilion-thread": "#C04851",
                        "ink-black": "#2c2c2c",
                        "ink-light": "#555555",
                        "champagne-gold": "#C6B08C",
                        "mist-cyan": "#8FA6AC",
                        "pale-jade": "#E0E8E4",
                        "paper-base": "#F5F2EB",
                        "paper-dark": "#EBE6D9",
                        // Mapped colors for existing logic compatibility
                        "primary": "#C04851",
                        "boss-primary": "#C04851",
                        // Legacy colors for other screens
                        "modal-dark": "#1c1414",
                        "paper": "#E3DCCF",
                        "gold-muted": "#8a7e68",
                        "obsidian": "#1c1c1c",
                    },
                    fontFamily: {
                        "serif": ["Noto Serif SC", "serif"],
                        "sans": ["Noto Serif SC", "serif"],
                    },
                    backgroundImage: {
                        'paper-texture': "url('https://www.transparenttextures.com/patterns/rice-paper-2.png')",
                        'ink-bleed': "linear-gradient(to right, transparent, rgba(0,0,0,0.03), transparent)",
                        'mist-gradient': "linear-gradient(to bottom, rgba(255,255,255,0.8), rgba(255,255,255,0))",
                        'ink-wash': "linear-gradient(rgba(24, 17, 17, 0.7), rgba(24, 17, 17, 0.9)), url('https://placeholder.pics/svg/400x800')", // Keep for compatibility
                    },
                    boxShadow: {
                        'glow-vermilion': '0 0 12px rgba(192, 72, 81, 0.6)',
                        'glow-cyan': '0 0 15px rgba(143, 166, 172, 0.3)',
                        'soft-paper': '0 10px 40px -10px rgba(0,0,0,0.05)',
                        'orb-glow': '0 0 25px rgba(255,255,255,0.6), inset 0 0 15px rgba(255,255,255,0.4)',
                    }
                },
            },
        }
    </script>
    <style>
        body {
            font-family: "Noto Serif SC", serif;
            background-color: #F5F2EB;
            color: #2c2c2c;
            min-height: max(884px, 100dvh);
            overflow: hidden;
        }

        .bg-xian-paper {
            background-color: #F5F2EB;
            background-image: url(https://lh3.googleusercontent.com/aida-public/AB6AXuABZS2s5x-WLYEKEHeqUWhiQ9bJjZNrb2Reb8AoGVSB86XQNcUG32Hf7ABRR9De9M_ZyOvKzAxe48uJgQu3SdAcKreocbRnmv-FOKGPbrgInamBZsk51fmhc73vKhWIvDMPG1MB3IyeHuZY4dSEodNFn4RwAHti_Jf2DnFJjsRVMPEpg7FXs8hxWvw4ucuirre15UhmaC353HdLnkLA5qlr2laS6U9VxcTr1abLub6wRplzpk9CV_4iWpWfnexnaeGAu8L-JACK0G8), radial-gradient(circle at 80% 20%, rgba(143, 166, 172, 0.08) 0%, transparent 40%), radial-gradient(circle at 20% 80%, rgba(198, 176, 140, 0.08) 0%, transparent 40%);
            background-blend-mode: multiply
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.02)
        }

        .glass-btn {
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(0, 0, 0, 0.03);
            transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1)
        }

        .glass-btn:hover {
            background: rgba(255, 255, 255, 0.8);
            border-color: rgba(198, 176, 140, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.03)
        }

        .glass-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .glass-btn:active {
            transform: scale(0.99)
        }

        /* Dynamic Interaction Colors */
        .glass-btn.btn-pink {
            background: rgba(255, 192, 203, 0.15);
            border-color: rgba(255, 105, 180, 0.2);
        }

        .glass-btn.btn-pink:hover {
            background: rgba(255, 192, 203, 0.3);
            border-color: rgba(255, 105, 180, 0.4);
        }

        .red-string-path {
            stroke-dasharray: 60;
            animation: thread-flow 40s linear infinite;
            filter: drop-shadow(0 0 4px rgba(192, 72, 81, 0.6))
        }

        @keyframes thread-flow {
            from {
                stroke-dashoffset: 0;
            }

            to {
                stroke-dashoffset: 1000;
            }
        }

        .string-pulse {
            animation: thread-pulse 3s infinite ease-in-out
        }

        @keyframes thread-pulse {

            0%,
            100% {
                opacity: 0.8;
                stroke-width: 2px;
            }

            50% {
                opacity: 1;
                stroke-width: 3px;
                filter: drop-shadow(0 0 8px rgba(192, 72, 81, 0.8));
            }
        }

        .orb-btn {
            background: radial-gradient(circle at 35% 35%, rgba(255, 255, 255, 0.95), rgba(230, 230, 230, 0.8));
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08), inset 0 0 20px rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.6);
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            backdrop-filter: blur(4px)
        }

        .orb-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(192, 72, 81, 0.15), inset 0 0 10px rgba(255, 255, 255, 1)
        }

        .orb-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(1);
        }

        .orb-mist {
            background: radial-gradient(circle, rgba(255, 255, 255, 0.8) 0%, transparent 70%);
            animation: mist-swirl 8s infinite linear
        }

        @keyframes mist-swirl {
            0% {
                transform: rotate(0deg) scale(1);
                opacity: 0.3;
            }

            50% {
                transform: rotate(180deg) scale(1.2);
                opacity: 0.5;
            }

            100% {
                transform: rotate(360deg) scale(1);
                opacity: 0.3;
            }
        }

        .progress-thread {
            height: 1px;
            background: rgba(0, 0, 0, 0.05);
            overflow: visible
        }

        .progress-fill-vermilion {
            background: #C04851;
            box-shadow: 0 0 4px rgba(192, 72, 81, 0.4)
        }

        .progress-fill-cyan {
            background: #8FA6AC;
            box-shadow: 0 0 4px rgba(143, 166, 172, 0.4)
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 3px
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px
        }

        .vertical-text {
            writing-mode: vertical-rl;
            text-orientation: upright;
            letter-spacing: 0.3em
        }

        .ink-wash-mask {
            mask-image: linear-gradient(to bottom, rgba(0, 0, 0, 1) 10%, rgba(0, 0, 0, 0.7) 50%, rgba(0, 0, 0, 0) 95%);
            -webkit-mask-image: linear-gradient(to bottom, rgba(0, 0, 0, 1) 10%, rgba(0, 0, 0, 0.7) 50%, rgba(0, 0, 0, 0) 95%)
        }

        @keyframes subtle-float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        .animate-float {
            animation: subtle-float 6s ease-in-out infinite
        }

        .knot-complex {
            transform-origin: center;
            animation: breathe-knot 4s ease-in-out infinite;
        }

        @keyframes breathe-knot {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
                filter: drop-shadow(0 0 10px rgba(192, 72, 81, 0.8));
            }
        }

        /* Utilities from Previous to keep modals working */
        .ink-splatter {
            mask-image: url('data:image/svg+xml;utf8,<svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><path d="M45.7,-76.3C58.9,-69.3,69.1,-55.5,76.5,-40.7C83.9,-25.9,88.5,-10.1,86.1,4.5C83.7,19.1,74.3,32.5,63.4,43.2C52.5,53.9,40.1,61.9,27.1,68.2C14.1,74.5,0.5,79.1,-11.9,76.8C-24.3,74.5,-35.5,65.3,-46.7,55.5C-57.9,45.7,-69.1,35.3,-75.6,22.2C-82.1,9.1,-83.9,-6.7,-78.5,-20.3C-73.1,-33.9,-60.5,-45.3,-47.1,-52.2C-33.7,-59.1,-19.5,-61.5,-4.8,-59.1C9.9,-56.7,29.8,-49.5,45.7,-76.3Z" transform="translate(100 100)" /></svg>');
            -webkit-mask-image: url('data:image/svg+xml;utf8,<svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><path d="M45.7,-76.3C58.9,-69.3,69.1,-55.5,76.5,-40.7C83.9,-25.9,88.5,-10.1,86.1,4.5C83.7,19.1,74.3,32.5,63.4,43.2C52.5,53.9,40.1,61.9,27.1,68.2C14.1,74.5,0.5,79.1,-11.9,76.8C-24.3,74.5,-35.5,65.3,-46.7,55.5C-57.9,45.7,-69.1,35.3,-75.6,22.2C-82.1,9.1,-83.9,-6.7,-78.5,-20.3C-73.1,-33.9,-60.5,-45.3,-47.1,-52.2C-33.7,-59.1,-19.5,-61.5,-4.8,-59.1C9.9,-56.7,29.8,-49.5,45.7,-76.3Z" transform="translate(100 100)" /></svg>');
            mask-size: contain;
            -webkit-mask-size: contain;
            mask-repeat: no-repeat;
            -webkit-mask-repeat: no-repeat;
            mask-position: center;
            -webkit-mask-position: center;
        }

        .scroll-border-top {
            background: linear-gradient(90deg, #2c1e1e 0%, #5d4037 50%, #2c1e1e 100%);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
        }

        .scroll-border-bottom {
            background: linear-gradient(90deg, #2c1e1e 0%, #5d4037 50%, #2c1e1e 100%);
            box-shadow: 0 -4px 6px rgba(0, 0, 0, 0.5);
        }

        .sepia-sketch {
            filter: sepia(0.8) contrast(1.1) brightness(0.7) grayscale(0.2);
            mix-blend-mode: normal
        }

        .mask-image-b-fade {
            mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
        }

        /* Animation Utilities for Modal/Other Screens */
        @keyframes fadeUp {
            0% {
                opacity: 0;
                transform: translateY(0);
            }

            20% {
                opacity: 1;
                transform: translateY(-20px);
            }

            100% {
                opacity: 0;
                transform: translateY(-60px);
            }
        }

        @keyframes pulse-slow {

            0%,
            100% {
                opacity: 0.6;
            }

            50% {
                opacity: 1;
            }
        }

        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fade-in 0.3s ease-out forwards;
        }
    </style>

    <!-- SCREEN 0: START MENU -->
    <div id="screen-start"
        class="fixed inset-0 z-[100] bg-[#1a0f0f] text-white font-display overflow-hidden select-none flex flex-col items-center justify-between">
        <!-- Background Image Layer -->
        <div class="absolute inset-0 z-0 w-full h-full">
            <!-- Base Image -->
            <div class="absolute inset-0 bg-cover bg-center opacity-80 scale-105 animate-[pulse_10s_ease-in-out_infinite]"
                style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuCd1GFkhCSKf67kEe0Wmw2uogPchua3NEqwiNmlTfwDlctj2b02apWUSQKxVEgHWUpe-vp8MjpYNVKQD47i4LQfK9Or2NbeRrNBTeyZd5cMtUDfcJKS76_SYaa65XiJDs5gvVp1556uAFPw-jQoccuiIX6WuVEnyuZrYxHdGT4QmRSliHBLriHdeDFj9iFQXRpSqjRPFq8utVx8PJReDnTFXp8BQyGKehzoIo8ndOQOglzJZptq4Vygv53ofih_1lTF72ICDiKc_DM');">
            </div>
            <!-- Ink Wash/Grain Overlay -->
            <div class="absolute inset-0 bg-black/40 mix-blend-multiply"></div>
            <!-- Vignette for focus -->
            <div class="absolute inset-0 bg-gradient-to-b from-black/70 via-transparent to-black/90"></div>
            <!-- Mist Layer (Bottom) -->
            <div
                class="absolute bottom-0 left-0 w-full h-1/2 bg-gradient-to-t from-background-dark to-transparent opacity-90">
            </div>
        </div>

        <!-- The Red String of Fate (Central Motif) -->
        <div class="absolute inset-0 z-10 flex justify-center pointer-events-none">
            <!-- The String Line -->
            <div
                class="w-[2px] h-full bg-gradient-to-b from-transparent via-primary to-transparent opacity-80 blur-[1px] animate-pulse-slow">
            </div>
            <!-- Glow effect around string -->
            <div class="absolute w-[4px] h-full bg-primary/30 blur-md animate-pulse"></div>
            <!-- Floating Particles (Ink/Spirits) near string -->
            <div class="absolute top-1/4 left-1/2 w-1 h-1 bg-primary rounded-full blur-[1px] animate-[float_4s_ease-in-out_infinite]"
                style="transform: translateX(-10px);"></div>
            <div class="absolute top-1/2 left-1/2 w-1.5 h-1.5 bg-red-400 rounded-full blur-[2px] animate-[float_6s_ease-in-out_infinite_reverse]"
                style="transform: translateX(5px);"></div>
            <div class="absolute bottom-1/3 left-1/2 w-1 h-1 bg-primary/60 rounded-full blur-[1px] animate-[float_5s_ease-in-out_infinite]"
                style="transform: translateX(-8px);"></div>
        </div>

        <!-- Header / Status (Minimal) -->
        <div class="relative z-20 w-full p-4 flex justify-between items-start opacity-70">
            <div class="flex items-center gap-1 text-xs text-stone-400">
                <span class="material-symbols-outlined text-[14px]">wifi</span>
                <span>46ms</span>
            </div>
            <div class="flex items-center gap-1 text-xs text-stone-400">
                <span class="material-symbols-outlined text-[14px]">person</span>
                <span>道友_9527</span>
            </div>
        </div>

        <!-- Title Section -->
        <div class="relative z-20 flex flex-col items-center pt-12 pb-8 w-full">
            <!-- Ink Splash behind title -->
            <div class="absolute top-0 left-1/2 -translate-x-1/2 w-64 h-64 bg-black/60 blur-3xl rounded-full -z-10">
            </div>
            <!-- English Subtitle -->
            <div class="tracking-[0.5em] text-gold-muted/80 text-[10px] font-bold mb-2">DESTINY CYCLE</div>
            <!-- Main Title (Vertical for traditional feel on mobile, or stacked horizontal) -->
            <div class="flex flex-col items-center">
                <h1 class="text-[56px] leading-tight font-black text-white text-shadow-ink tracking-widest relative">
                    <span class="block bg-clip-text text-transparent bg-gradient-to-b from-stone-100 to-stone-400"
                        style="-webkit-text-stroke: 1px rgba(255,255,255,0.1);">宿命</span>
                    <span
                        class="block bg-clip-text text-transparent bg-gradient-to-b from-primary to-primary-dark mt-[-10px] text-shadow-glow"
                        style="-webkit-text-stroke: 1px rgba(230,25,25,0.3);">轮回</span>
                </h1>
            </div>
            <!-- Decorative line -->
            <div class="w-16 h-[1px] bg-gradient-to-r from-transparent via-gold-muted to-transparent mt-6 opacity-60">
            </div>
        </div>

        <!-- Spacer to push content -->
        <div class="flex-grow"></div>

        <!-- Menu Navigation Section -->
        <div class="relative z-30 w-full max-w-md px-8 pb-12 flex flex-col gap-5 items-center">
            <!-- Primary Action: Start Cultivation -->
            <button id="btn-start-game"
                class="group relative w-full h-16 flex items-center justify-center overflow-hidden rounded-xl bg-gradient-to-r from-[#2a0a0a] via-[#450a0a] to-[#2a0a0a] border border-primary/50 shadow-[0_0_15px_rgba(230,25,25,0.3)] transition-all duration-300 hover:scale-[1.02] active:scale-[0.98]">
                <!-- Animated background glow -->
                <div class="absolute inset-0 bg-primary/10 group-hover:bg-primary/20 transition-colors"></div>
                <!-- Particle effect inside button -->
                <div class="absolute right-0 top-0 h-full w-1/2 bg-gradient-to-l from-primary/10 to-transparent"></div>
                <div class="relative flex items-center gap-3">
                    <span
                        class="material-symbols-outlined text-primary group-hover:text-white transition-colors">self_improvement</span>
                    <span
                        class="text-xl font-bold text-stone-100 tracking-[0.2em] group-hover:text-white group-hover:text-shadow-glow transition-all">开始修行</span>
                    <span class="material-symbols-outlined text-primary group-hover:text-white transition-colors"
                        style="transform: scaleX(-1);">self_improvement</span>
                </div>
                <!-- Corner accents -->
                <div class="absolute top-0 left-0 w-2 h-2 border-t border-l border-primary"></div>
                <div class="absolute bottom-0 right-0 w-2 h-2 border-b border-r border-primary"></div>
            </button>
            <!-- Secondary Actions Container -->
            <div class="w-full flex flex-col gap-3">
                <!-- Continue (Auto Save) -->
                <button id="btn-continue-game"
                    class="group w-full h-12 flex items-center justify-center bg-[#2a2323] rounded-lg border border-stone-600/50 hover:border-gold-muted/50 transition-all active:translate-y-0.5 shadow-lg">
                    <span
                        class="material-symbols-outlined text-stone-400 text-sm mr-2 group-hover:text-gold-muted transition-colors">resume</span>
                    <span
                        class="text-stone-300 font-medium tracking-widest text-sm group-hover:text-gold-muted transition-colors">继续前缘
                        (自动存档)</span>
                </button>
                <!-- Load Game (Manual) -->
                <button id="btn-load-game"
                    class="group w-full h-12 flex items-center justify-center bg-[#2a2323] rounded-lg border border-stone-600/50 hover:border-gold-muted/50 transition-all active:translate-y-0.5 shadow-lg">
                    <span
                        class="material-symbols-outlined text-stone-400 text-sm mr-2 group-hover:text-gold-muted transition-colors">history_edu</span>
                    <span
                        class="text-stone-300 font-medium tracking-widest text-sm group-hover:text-gold-muted transition-colors">读取手扎
                        (手动存档)</span>
                </button>
                <!-- Settings & Exit (Split Row) -->
                <div class="flex w-full gap-3">
                    <button
                        class="group flex-1 h-12 flex items-center justify-center bg-[#2a2323] rounded-lg border border-stone-600/50 hover:border-gold-muted/50 transition-all active:translate-y-0.5 shadow-lg">
                        <span
                            class="material-symbols-outlined text-stone-400 text-sm mr-2 group-hover:text-gold-muted transition-colors">settings_b_roll</span>
                        <span
                            class="text-stone-300 font-medium tracking-widest text-sm group-hover:text-gold-muted transition-colors">万象设定</span>
                    </button>
                    <button
                        class="group flex-1 h-12 flex items-center justify-center bg-[#2a2323] rounded-lg border border-stone-600/50 hover:border-red-500/30 transition-all active:translate-y-0.5 shadow-lg">
                        <span
                            class="material-symbols-outlined text-stone-500 text-sm mr-2 group-hover:text-red-400 transition-colors">logout</span>
                        <span
                            class="text-stone-400 font-medium tracking-widest text-sm group-hover:text-red-400 transition-colors">别离江湖</span>
                    </button>
                </div>
            </div>
            <!-- Footer Info -->
            <div class="mt-4 flex flex-col items-center gap-1 opacity-40">
                <p class="text-[10px] text-stone-500 uppercase tracking-wider">Ver 1.0.0.45 Beta</p>
                <p class="text-[10px] text-stone-600 font-sans">© 2024 TianYuan Interactive</p>
            </div>
        </div>
        <!-- Foreground Mist Animation Overlay -->
        <div
            class="absolute bottom-0 left-0 w-[200%] h-64 bg-gradient-to-t from-background-dark/80 via-transparent to-transparent opacity-30 pointer-events-none animate-drift z-20">
        </div>
    </div>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet" />
</head>

<body
    class="bg-xian-paper text-ink-black w-full h-screen overflow-hidden selection:bg-champagne-gold selection:text-white">
    <div id="screen-main"
        class="fixed inset-0 z-10 w-full h-screen flex items-center justify-center overflow-hidden pointer-events-none"
        style="display:none; pointer-events: none;"> <!-- Hidden by default, toggled by JS. -->
        <!-- Logic will remove 'hidden' class or set display:flex. I added pointer-events-auto to inner container -->
        <div
            class="relative flex flex-col w-full h-full lg:aspect-video lg:max-w-[1600px] lg:max-h-[900px] lg:h-[90vh] lg:rounded-sm shadow-soft-paper overflow-hidden border border-white/40 bg-white/30 backdrop-blur-sm pointer-events-auto">

            <div
                class="relative z-40 w-full glass-panel border-b border-black/[0.03] p-5 shrink-0 flex items-center justify-between h-[10%]">
                <div class="flex items-center gap-8">
                    <div class="flex flex-col relative">
                        <div class="absolute -left-3 -top-2 w-8 h-8 rounded-full bg-champagne-gold/10 blur-xl"></div>
                        <h1
                            class="text-ink-black font-bold text-2xl tracking-[0.4em] uppercase drop-shadow-sm opacity-90">
                            宿命轮回</h1>
                        <span class="text-[10px] text-ink-light/60 uppercase tracking-[0.2em] pl-1 font-light">Fate
                            Reincarnation</span>
                    </div>
                    <div class="h-8 w-px bg-gradient-to-b from-transparent via-black/10 to-transparent mx-2"></div>
                    <div class="flex items-baseline gap-2">
                        <span class="text-3xl font-light text-ink-black tracking-widest"><span
                                id="turn-count-display">20</span></span>
                        <span class="text-xs text-ink-light/60 font-medium">/ 30 天</span>
                        <div class="w-px h-4 bg-black/10 mx-2"></div>
                        <span id="phase-display"
                            class="text-xs font-serif font-bold tracking-widest text-vermilion-thread">辰时 · 筹备</span>
                    </div>
                </div>
                <div
                    class="flex items-center gap-3 px-6 py-2 rounded-full border border-mist-cyan/20 bg-white/40 shadow-sm backdrop-blur-md">
                    <span class="material-symbols-outlined text-mist-cyan text-lg animate-pulse">cloud</span>
                    <span class="text-ink-light/70 text-xs font-semibold uppercase tracking-widest">虚无之雾 · 迫近</span>
                </div>
            </div>

            <div class="relative flex w-full h-[55%] overflow-hidden">
                <div class="w-1/2 relative h-full bg-[#fcfbf9] overflow-hidden group">
                    <div class="absolute inset-0 bg-paper-texture opacity-50 mix-blend-multiply"></div>
                    <div
                        class="absolute top-0 left-0 w-full h-full bg-[radial-gradient(ellipse_at_top_left,_var(--tw-gradient-stops))] from-gray-200/40 via-transparent to-transparent opacity-60">
                    </div>
                    <div class="absolute inset-0 opacity-[0.85] bg-cover bg-center transition-transform duration-[20s] ease-in-out group-hover:scale-105 ink-wash-mask mix-blend-multiply grayscale contrast-[0.9]"
                        style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuCQ9U64bDQ24wFHHW_VFGbbuKAe8KNtt1kO-hn7q8oEuqnDQlRae8WWZBceKJjFJTa3DwpNVBGZUB0_T5qItN-KX4qM_PXuBsSvrR7zoRO5dExdPkqDpLqcH-Kco0o_XdKvBI-4chez_4bpnRB2D1hWeKGueSOUOz02OL0yuSv_hBOO1Oce0Y7HDcn4Pm9EaUr9Ne7nYYFP8kjjbVkwZJzhlYvVQby0D0IB8usFzO6jaqf3biZWkksnflyf4HDHwlOGSl_QALKltio');">
                    </div>
                    <div class="absolute inset-0 flex flex-col items-center justify-center pb-10 z-10">
                        <div
                            class="relative w-48 h-48 mb-4 transition-transform duration-700 group-hover:translate-y-[-5px]">
                            <div
                                class="absolute inset-0 bg-ink-black opacity-[0.03] rounded-full blur-2xl transform scale-125">
                            </div>
                            <img alt="Broken Sword"
                                class="w-full h-full object-contain drop-shadow-xl grayscale opacity-90 mix-blend-darken"
                                src="https://lh3.googleusercontent.com/aida-public/AB6AXuDuQc_UoeWgt5mVQuzufp7suZy3io9m4vbr_HTItNyf5kJSFGC8pwpKcfm9PC7GIxf0-r3K075Rb7v8lAoJ2-qeg9TYQAwzk0Y58miH_y0hH4iedfoq5g0P0dkCGh0r-U-V6kLRT6WMJSSr4kYdDDgpGmcmN5TYrVmTa8-lEU2c9ynESRFs6yOX1lLCKQMcZFn8FQvCUVUdT5q-nsvAO09hwgCdZ0nbZtHNGX1VaZG1DQKBMSIj7L9F2OkmRKYy7Wk7cy2gFzmZeOw" />
                        </div>
                        <h2 class="text-ink-black text-3xl font-light tracking-[0.6em] uppercase mb-2 opacity-90"
                            style="text-shadow: 0 2px 10px rgba(0,0,0,0.1);">掌门</h2>
                        <div class="w-px h-8 bg-gradient-to-b from-champagne-gold to-transparent mb-2 opacity-50"></div>
                        <p class="text-ink-light text-[10px] font-serif tracking-[0.3em] opacity-70">「 剑身虽断 · 剑意千秋 」</p>
                    </div>
                    <div class="absolute bottom-6 left-10 right-16 z-20 max-w-sm pl-6 border-l border-ink-black/10">
                        <div class="flex justify-between items-end mb-2">
                            <span
                                class="text-[10px] font-bold text-ink-light uppercase tracking-[0.2em] flex items-center gap-2">
                                <span
                                    class="material-symbols-outlined text-[16px] text-vermilion-thread opacity-70">swords</span>
                                岳清源战力
                            </span>
                            <span id="yue-power-display"
                                class="text-lg font-serif text-vermilion-thread drop-shadow-sm tracking-widest">---</span>
                        </div>
                        <div class="progress-thread w-full relative">
                            <div id="health-bar"
                                class="absolute top-0 left-0 h-px bg-vermilion-thread progress-fill-vermilion transition-all duration-1000"
                                style="width: 100%"></div>
                        </div>
                    </div>
                </div>

                <div
                    class="absolute left-1/2 top-0 bottom-0 w-32 -translate-x-1/2 z-30 pointer-events-none flex justify-center">
                    <div
                        class="w-px h-full bg-gradient-to-b from-transparent via-vermilion-thread/20 to-transparent blur-[1px]">
                    </div>
                    <svg class="absolute inset-0 w-full h-full string-pulse overflow-visible" preserveAspectRatio="none"
                        viewBox="0 0 100 800">
                        <defs>
                            <filter height="200%" id="thread-glow" width="200%" x="-50%" y="-50%">
                                <feGaussianBlur result="coloredBlur" stdDeviation="1.5"></feGaussianBlur>
                                <feMerge>
                                    <feMergeNode in="coloredBlur"></feMergeNode>
                                    <feMergeNode in="SourceGraphic"></feMergeNode>
                                </feMerge>
                            </filter>
                        </defs>
                        <path d="M 50 0 L 50 350 C 50 350 30 380 50 400 C 70 420 50 450 50 450 L 50 800" fill="none"
                            opacity="0.3" stroke="#C04851" stroke-width="2"></path>
                        <path id="red-string-main" class="red-string-path"
                            d="M 50 0 L 50 320C 50 350, 20 360, 40 390C 60 410, 50 400, 50 400C 50 400, 40 390, 60 410C 80 440, 50 450, 50 480L 50 800"
                            fill="none" filter="url(#thread-glow)" stroke="#C04851" stroke-linecap="round"
                            stroke-opacity="1" stroke-width="2.5"></path>
                        <circle id="red-string-knot" class="animate-pulse knot-complex" cx="50" cy="400" fill="#C04851"
                            r="5"></circle>
                    </svg>
                    <div
                        class="absolute top-1/2 -translate-y-16 left-1/2 -translate-x-1/2 flex flex-col items-center gap-1 bg-paper-base/30 backdrop-blur-sm p-2 rounded-full border border-vermilion-thread/10">
                        <span class="text-[10px] text-vermilion-thread font-bold uppercase tracking-[0.2em]">羁绊</span>
                        <span id="bond-center-display"
                            class="text-lg text-vermilion-thread font-serif font-bold">92</span>
                    </div>
                </div>

                <div class="w-1/2 relative h-full bg-[#f4f8f7] overflow-hidden group">
                    <div class="absolute inset-0 bg-paper-texture opacity-50 mix-blend-multiply"></div>
                    <div
                        class="absolute top-0 right-0 w-full h-full bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-mist-cyan/10 via-transparent to-transparent opacity-60">
                    </div>
                    <div class="absolute inset-0 opacity-[0.8] bg-cover bg-center transition-transform duration-[20s] ease-in-out group-hover:scale-105 ink-wash-mask mix-blend-multiply sepia-[0.2] contrast-[0.9]"
                        style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuArNkqeFjTVpNHRfJCcrJYo-JRQ6Dq01apUkXTRglFkDzYo6lglc0MlIvZeYTlvpUMAjdlOjUTrdJTszx1fjxbYRxjal4fteOox3-ujO744cWGht7Cz4MssVwCo7F1kjgjqS7Aeb_JRkGecwppamXRIokQvvGis5wEyAQji4rmI1wj7zd-2r5dE1R-HtBAlyv5uuxLkjjgCe_P0O3tfl49hZrtp50hrU5Dmy6dDpSVbM1xQdMt0Hjeu21b8-cHEVdCnGT0pitlXon4');">
                    </div>
                    <div class="absolute inset-0 flex flex-col items-center justify-center pb-10 z-10">
                        <div
                            class="relative w-48 h-48 mb-4 transition-transform duration-700 group-hover:translate-y-[-5px]">
                            <div
                                class="absolute inset-0 bg-mist-cyan opacity-[0.1] rounded-full blur-2xl transform scale-125">
                            </div>
                            <img alt="Fan"
                                class="w-full h-full object-contain drop-shadow-xl opacity-90 mix-blend-darken"
                                src="https://lh3.googleusercontent.com/aida-public/AB6AXuC2aET8Rg1IfJ3ToRKeCLSqy_bdmuALR8y59_3vwwG68sVbLsBWoCAHMOceje0-wLb0cVIkBYL6hDoZhJ1OlRzLE8Dmjr6hnQTeRK7jdJULfVwU3FqP-C2NWLz7jWgqTsd8NGgw969VMnr0OapEWVEeQqgfQsExlp9QVrcQoTAVWH-QkxbuWGNpMm8PBJihre4ugUY2fzcwdxdfmDq8ZO52D4IBd3HAh6TQ2rbNikO0fVL29CTxhhVRZ8B8BoLrvoxPcDEILoOKeYE" />
                        </div>
                        <h2 class="text-ink-black text-3xl font-light tracking-[0.6em] uppercase mb-2 opacity-90"
                            style="text-shadow: 0 2px 10px rgba(0,0,0,0.1);">书生</h2>
                        <div class="w-px h-8 bg-gradient-to-b from-mist-cyan to-transparent mb-2 opacity-50"></div>
                        <p class="text-ink-light text-[10px] font-serif tracking-[0.3em] opacity-70">「 墨痕深似血 · 回响透古今 」
                        </p>
                    </div>
                    <div
                        class="absolute bottom-6 right-10 left-16 z-20 max-w-sm pr-6 border-r border-ink-black/10 text-right ml-auto">
                        <div class="flex justify-between items-end mb-2 flex-row-reverse">
                            <span
                                class="text-[10px] font-bold text-ink-light uppercase tracking-[0.2em] flex items-center gap-2 flex-row-reverse">
                                <span
                                    class="material-symbols-outlined text-[16px] text-mist-cyan opacity-80">flare</span>
                                沈清秋战力
                            </span>
                            <span id="shen-power-display"
                                class="text-lg font-serif text-mist-cyan drop-shadow-sm font-semibold tracking-widest">---</span>
                        </div>
                        <div class="progress-thread w-full relative">
                            <div id="bond-bar"
                                class="absolute top-0 right-0 h-px bg-mist-cyan progress-fill-cyan transition-all duration-1000"
                                style="width: 78%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div
                class="relative z-40 bg-paper-base/95 backdrop-blur-md border-t border-black/[0.05] flex flex-col h-[35%] shrink-0 shadow-[0_-10px_40px_rgba(0,0,0,0.02)]">
                <div
                    class="w-full flex justify-center items-center h-[90px] bg-white/40 border-b border-black/[0.03] relative z-20">
                    <div class="flex items-center gap-4 lg:gap-8 px-8 w-full justify-center">
                        <!-- Left Controls -->
                        <button id="btn-cultivate"
                            class="glass-btn px-4 py-2 rounded-sm flex flex-col items-center gap-1 group relative overflow-hidden min-w-[100px]">
                            <span
                                class="material-symbols-outlined text-champagne-gold/80 group-hover:text-ink-black transition-colors font-light text-xl">self_improvement</span>
                            <span class="text-xs font-serif text-ink-black/90 tracking-[0.2em] font-medium">岳修炼</span>
                        </button>

                        <button id="btn-shen-cultivate"
                            class="glass-btn px-4 py-2 rounded-sm flex flex-col items-center gap-1 group relative overflow-hidden min-w-[100px]">
                            <span
                                class="material-symbols-outlined text-mist-cyan/80 group-hover:text-ink-black transition-colors font-light text-xl">forest</span>
                            <span class="text-xs font-serif text-ink-black/90 tracking-[0.2em] font-medium">沈修炼</span>
                        </button>

                        <!-- Center: Next Day -->
                        <div class="relative -top-6 mx-4">
                            <button id="btn-rest"
                                class="orb-btn w-24 h-24 rounded-full flex flex-col items-center justify-center group cursor-pointer relative overflow-hidden shadow-orb-glow bg-paper-base border border-chamber-gold/30">
                                <div class="orb-mist absolute inset-0"></div>
                                <span
                                    class="material-symbols-outlined text-ink-black/70 text-3xl group-hover:rotate-180 transition-transform duration-700 relative z-10 font-thin">wb_twilight</span>
                                <span
                                    class="text-xs text-ink-black/80 font-bold uppercase mt-1 tracking-[0.3em] relative z-10">翌日</span>
                            </button>
                        </div>

                        <!-- Right Controls -->
                        <button id="btn-interact"
                            class="glass-btn px-4 py-2 rounded-sm flex flex-col items-center gap-1 group relative overflow-hidden min-w-[100px]">
                            <span
                                class="material-symbols-outlined text-vermilion-thread/60 group-hover:text-ink-black transition-colors font-light text-xl">chat_bubble</span>
                            <span class="text-xs font-serif text-ink-black/90 tracking-[0.2em] font-medium">解释</span>
                        </button>

                        <button id="btn-save"
                            class="glass-btn px-4 py-2 rounded-sm flex flex-col items-center gap-1 group relative overflow-hidden min-w-[100px]">
                            <span
                                class="material-symbols-outlined text-ink-light/50 group-hover:text-ink-black transition-colors font-light text-xl">save</span>
                            <span class="text-xs font-serif text-ink-black/90 tracking-[0.2em] font-medium">存档</span>
                        </button>
                    </div>
                </div>
                <div class="flex-1 w-full bg-[#f9f8f4] relative overflow-hidden">
                    <div class="absolute inset-0 bg-paper-texture opacity-60"></div>
                    <div
                        class="absolute top-0 left-0 w-full h-4 bg-gradient-to-b from-black/[0.02] to-transparent pointer-events-none z-10">
                    </div>
                    <div id="log-container"
                        class="h-full w-full px-8 lg:px-20 py-6 overflow-y-auto custom-scrollbar relative z-10 flex flex-col gap-3">
                        <div
                            class="flex items-center gap-4 mb-4 opacity-50 sticky top-0 bg-[#f9f8f4]/90 backdrop-blur-sm z-20 py-2 border-b border-black/5">
                            <span class="w-1 h-1 bg-ink-black/60 rounded-full"></span>
                            <h3 class="text-[10px] font-bold text-ink-black uppercase tracking-[0.3em]">历练纪事</h3>
                            <div class="h-px bg-ink-black/10 flex-1"></div>
                        </div>
                        <!-- Logs will participate here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- SCREEN 2: MEMORY MODAL -->
    <div id="screen-memory" style="display: none;"
        class="fixed inset-0 z-50 flex items-center justify-center bg-ink-wash bg-cover bg-center p-4">
        <div class="absolute inset-0 bg-black/70 backdrop-blur-sm z-0"></div>
        <div
            class="relative z-10 w-full max-w-5xl flex flex-col bg-modal-dark shadow-2xl overflow-hidden rounded-lg border border-white/5">
            <div class="h-4 w-full scroll-border-top border-b border-[#1a1a1a] relative z-20"></div>
            <div class="relative flex flex-col w-full">
                <div
                    class="absolute top-8 left-0 right-0 z-20 flex flex-col items-center justify-center pointer-events-none">
                    <div
                        class="bg-black/60 backdrop-blur-md px-10 py-2 rounded-full border border-white/10 flex items-center gap-3 shadow-2xl">
                        <span class="material-symbols-outlined text-primary/90 text-xl">history_edu</span>
                        <h2 class="text-xl tracking-[0.3em] text-white/90 font-bold drop-shadow-md">回忆解锁</h2>
                    </div>
                </div>
                <div class="relative w-full aspect-[21/9] bg-[#100c0c] overflow-hidden group border-b border-white/5">
                    <div class="absolute inset-0 bg-cover bg-center sepia-sketch transition-transform duration-[20s] group-hover:scale-105 ease-out"
                        style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuAU92YrW4TIdZhcgJvGRuSq72-_hQGpCA_OnxYzeBQCWTqzAZF48fU9kNs6T58w0Y8ybAP1Xc7LvTbPDBvhDYsV_zypl7LYeHYxEF8mEMZyMzzdK3NBHINiUSihAosF71KcGXXfKKJJO2UCfvTeOgJor8PZhYHchfToHXVFWKwA-LpA9A2J6FKI5swyB9EBfEMcPm3rtSH1yOul3sr2BYsT85puK4rKzHky_a0JmGlapqrBS-1OCv_Z-I_com-kEWFLW7j1lv0YjgY"); background-position: center 30%;'>
                    </div>
                    <div
                        class="absolute inset-0 bg-[radial-gradient(circle_at_center,transparent_0%,rgba(0,0,0,0.5)_70%,rgba(0,0,0,1)_100%)]">
                    </div>
                </div>
                <div class="relative bg-modal-dark pb-12 px-8 md:px-16 flex flex-col items-center">
                    <div
                        class="relative -mt-16 w-full max-w-2xl bg-paper shadow-[0_10px_40px_rgba(0,0,0,0.5)] rounded-sm p-1 border border-[#d6d0c4] transform transition-transform duration-500 z-10">
                        <div class="relative border border-[#c4bbaa] p-8 shadow-inner-paper flex flex-col items-center">
                            <span class="material-symbols-outlined text-primary/30 text-3xl mb-3">format_quote</span>
                            <p
                                class="font-display text-ink text-lg md:text-xl leading-8 text-center font-medium max-w-lg typewriter-cursor">
                                寒冬腊月，大雪纷飞。<br />那半个冷硬的馒头，是<span class="text-primary font-bold mx-1">你我缘分</span>的开始...
                            </p>
                        </div>
                    </div>
                    <div class="flex flex-row gap-12 mt-12 w-full justify-center items-center z-10"><button
                            id="btn-memory-recall"
                            class="group relative px-10 py-3 bg-[#2d1b1b] overflow-hidden rounded-md shadow-[0_4px_14px_0_rgba(0,0,0,0.5)] border border-[#4a2e2e] hover:border-primary/60 transition-all active:scale-[0.98] min-w-[200px] text-white"><span
                                class="font-bold tracking-[0.15em]">铭记于心</span></button><button id="btn-memory-forget"
                            class="group relative px-10 py-3 bg-transparent border border-white/10 hover:bg-white/5 rounded-md transition-all active:scale-[0.98] min-w-[200px] text-white"><span
                                class="font-bold tracking-[0.15em]">随风而去</span></button></div>
                </div>
            </div>
            <div class="h-4 w-full scroll-border-bottom border-t border-[#1a1a1a] relative z-20"></div>
        </div>
    </div>
    <!-- SCREEN 3: BOSS BATTLE -->
    <div id="screen-boss" style="display: none;"
        class="fixed inset-0 z-[60] bg-[#0a0a0c] text-white font-display overflow-hidden select-none items-center justify-center">
        <!-- Left Panel: Yue Qingyuan -->
        <div
            class="absolute left-0 top-0 bottom-0 w-[280px] z-40 flex flex-col bg-gradient-to-r from-[#0f1115] to-[#1a1d23]/95 border-r border-white/5 shadow-2xl overflow-hidden backdrop-blur-sm">
            <div
                class="absolute inset-0 opacity-30 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] mix-blend-overlay">
            </div>
            <div
                class="absolute inset-0 bg-gradient-to-b from-black/60 via-transparent to-black/80 pointer-events-none">
            </div>
            <div class="relative z-10 flex-1 flex flex-col pt-8 pb-0 px-6">
                <div class="mb-8 border-b border-red-900/30 pb-4">
                    <h2 class="text-3xl font-serif text-gray-200 tracking-[0.3em] font-bold text-shadow-sm">
                        岳清源</h2>
                    <div
                        class="text-[10px] text-gray-500 font-mono mt-1 uppercase tracking-[0.2em] flex justify-between">
                        <span>SECT LEADER</span><span class="text-red-900 font-bold">UNK-001</span>
                    </div>
                </div>
                <div class="flex-1 flex justify-center gap-10">
                    <!-- Stat 1: Removed Shenhun as it's not a backend stat -->
                    <!-- Stat 2 -->
                    <div class="flex flex-col items-center h-full">
                        <div class="mb-3 text-center">
                            <div
                                class="w-10 h-10 rounded-full bg-[#2a1010] border border-red-600/50 flex items-center justify-center shadow-[0_0_15px_rgba(220,38,38,0.2)]">
                                <span class="material-symbols-outlined text-red-500 text-lg">coronavirus</span>
                            </div>
                        </div>
                        <div
                            class="relative flex-1 w-5 bg-black/60 rounded-full border border-red-900/30 shadow-inner overflow-hidden ring-1 ring-white/5">
                            <div class="absolute inset-0 flex flex-col justify-between py-2 px-[2px] z-20 opacity-40">
                                <div class="w-full h-px bg-red-900"></div>
                                <div class="w-full h-px bg-red-900"></div>
                                <div class="w-full h-px bg-red-900"></div>
                                <div class="w-full h-px bg-red-900"></div>
                                <div class="w-full h-px bg-red-900"></div>
                            </div>
                            <div id="boss-yue-health-bar"
                                class="absolute bottom-0 w-full bg-gradient-to-t from-red-950 via-red-800 to-red-600 shadow-[0_0_20px_rgba(220,38,38,0.6)] transition-all duration-500"
                                style="height: 85%">
                            </div>
                            <div class="absolute top-0 w-full h-full bg-red-500/20 animate-pulse z-10">
                            </div>
                        </div>
                        <div class="mt-3"><span
                                class="text-sm text-red-500/90 font-serif writing-vertical tracking-widest font-bold text-shadow-glow">寿元</span>
                        </div>
                    </div>
                </div>
                <div class="h-64 -mx-6 -mb-6 mt-8 relative mask-image-b-fade">
                    <div class="absolute inset-0 bg-gradient-to-t from-black via-[#0f1115] to-transparent z-10">
                    </div><img
                        class="w-full h-full object-cover object-top opacity-70 mix-blend-luminosity hover:mix-blend-normal transition-all duration-700"
                        src="https://lh3.googleusercontent.com/aida-public/AB6AXuAb1f7LHVjvBC6UQJL8n9AnCKt0oB524vlLynxeATsYkDNUJQAvhN1CQpmCjwPt5TbXEZnviyO082ylrmcUPpWHu91r085vHbJKZI2Vl-5Rii_KYJYqhgC_HhZEXD3sBSnaDgD27OzWCdfF6hnt1aJZTbu6AZEQ9q6hv_K6rFiK66wuH3FVp6XPr5MSsGJBZBGs2k8ZeiO7hSZQVh_9zqkzTo_agQGG79myviH6rssC0ZUPXwsTVRPjWfZ-6D68a6fytPatDmCqpI8"
                        style="mask-image: linear-gradient(to bottom, black 40%, transparent 100%);" />
                </div>
            </div>
        </div>
        <!-- Right Panel: Shen Qingqiu -->
        <div
            class="absolute right-0 top-0 bottom-0 w-[280px] z-40 flex flex-col bg-gradient-to-l from-[#e6e8e6] to-[#f0f2f0]/95 border-l border-gray-300 shadow-2xl overflow-hidden backdrop-blur-sm">
            <div
                class="absolute inset-0 opacity-40 bg-[url('https://www.transparenttextures.com/patterns/clean-gray-paper.png')] mix-blend-multiply">
            </div>
            <div
                class="absolute right-0 top-0 bottom-0 w-12 bg-[url('https://www.transparenttextures.com/patterns/bamboo.png')] opacity-10 mix-blend-darken">
            </div>
            <div class="relative z-10 flex-1 flex flex-col pt-8 pb-0 px-6 text-gray-800">
                <div class="mb-8 border-b border-green-800/20 pb-4 text-right">
                    <h2 class="text-3xl font-serif text-gray-800 tracking-[0.3em] font-bold drop-shadow-sm">
                        沈清秋</h2>
                    <div
                        class="text-[10px] text-gray-500 font-mono mt-1 uppercase tracking-[0.2em] flex justify-between flex-row-reverse">
                        <span>PEAK LORD</span><span class="text-green-800 font-bold">SQQ-009</span>
                    </div>
                </div>
                <!-- Stats -->
                <div class="flex-1 flex justify-center gap-10">
                    <!-- Stat 1 -->
                    <div class="flex flex-col items-center h-full">
                        <div class="mb-3 text-center">
                            <div
                                class="w-10 h-10 rounded-full bg-[#e0f2f1] border border-teal-400/50 flex items-center justify-center shadow-[0_0_15px_rgba(45,212,191,0.2)]">
                                <span class="material-symbols-outlined text-teal-600 text-lg">spa</span>
                            </div>
                        </div>
                        <div
                            class="relative flex-1 w-5 bg-gray-200/80 rounded-full border border-teal-900/10 shadow-inner overflow-hidden ring-1 ring-black/5">
                            <div class="absolute inset-0 flex flex-col justify-between py-2 px-[2px] z-20 opacity-30">
                                <div class="w-full h-px bg-teal-900"></div>
                                <div class="w-full h-px bg-teal-900"></div>
                                <div class="w-full h-px bg-teal-900"></div>
                                <div class="w-full h-px bg-teal-900"></div>
                                <div class="w-full h-px bg-teal-900"></div>
                            </div>
                            <div id="boss-shen-power-bar"
                                class="absolute bottom-0 w-full bg-gradient-to-t from-teal-700 via-teal-500 to-teal-200 shadow-[0_0_15px_rgba(20,184,166,0.5)] transition-all duration-500"
                                style="height: 45%">
                            </div>
                        </div>
                        <div class="mt-3"><span
                                class="text-sm text-teal-800/90 font-serif writing-vertical tracking-widest font-bold">灵力</span>
                        </div>
                    </div>
                    <!-- Stat 2 -->
                    <div class="flex flex-col items-center h-full">
                        <div class="mb-3 text-center">
                            <div
                                class="w-10 h-10 rounded-full bg-[#fdf2f8] border border-pink-400/50 flex items-center justify-center shadow-[0_0_15px_rgba(236,72,153,0.2)]">
                                <span class="material-symbols-outlined text-pink-500 text-lg">favorite</span>
                            </div>
                        </div>
                        <div
                            class="relative flex-1 w-5 bg-gray-200/80 rounded-full border border-pink-900/10 shadow-inner overflow-hidden ring-1 ring-black/5">
                            <div class="absolute inset-0 flex flex-col justify-between py-2 px-[2px] z-20 opacity-30">
                                <div class="w-full h-px bg-pink-900"></div>
                                <div class="w-full h-px bg-pink-900"></div>
                                <div class="w-full h-px bg-pink-900"></div>
                                <div class="w-full h-px bg-pink-900"></div>
                                <div class="w-full h-px bg-pink-900"></div>
                            </div>
                            <div id="boss-shen-bond-bar"
                                class="absolute bottom-0 w-full bg-gradient-to-t from-pink-600 via-pink-400 to-pink-200 shadow-[0_0_15px_rgba(236,72,153,0.5)] transition-all duration-500"
                                style="height: 0%">
                            </div>
                        </div>
                        <div class="mt-3"><span
                                class="text-sm text-pink-700/90 font-serif writing-vertical tracking-widest font-bold">羁绊</span>
                        </div>
                    </div>
                </div>
                <div class="h-64 -mx-6 -mb-6 mt-8 relative">
                    <div class="absolute inset-0 bg-gradient-to-t from-[#e6e8e6] via-[#f0f2f0]/50 to-transparent z-10">
                    </div><img
                        class="w-full h-full object-cover object-top opacity-90 mix-blend-multiply hover:mix-blend-normal transition-all duration-700"
                        src="https://lh3.googleusercontent.com/aida-public/AB6AXuDmSksBLsrVtiiftMAFSZrBiwpHDue9qZW4uWwSWoJhCPw6H4vnoe5G6eK_CcVPVb9jV4srkCpquDN7PYSeq7WZvLawmpjXQAta53-f6SPKBn_y1wP4JfyidSnGFaORH8xNH46eJPPapwHf_B_ftaKPx8D0XwLiNSdEvMcMzb_Gs6nUMtEkXXiW-atEb4veQGV_riMUamF98d8mRAbsobRgKiujCC4sJT-Vi2U1TIshZC6wcz8VHOTkV48FgNnfMHU6ScMviywS4g0"
                        style="mask-image: linear-gradient(to bottom, black 40%, transparent 100%);" />
                </div>
            </div>
        </div>
        <!-- Center Stage -->
        <div class="relative w-full h-full bg-[#0a0a0c] overflow-hidden flex flex-col">
            <!-- Top Status Bar -->
            <div
                class="absolute top-0 left-0 w-full z-50 flex items-start justify-between px-8 py-4 pointer-events-none bg-gradient-to-b from-black/90 to-transparent h-32 pl-[300px] pr-[300px]">
                <div class="flex flex-col pointer-events-auto"><button
                        class="flex items-center gap-2 hover:text-boss-primary transition-colors mb-1"><span
                            class="material-symbols-outlined text-white/80">arrow_back_ios_new</span><span
                            class="text-white/60 text-sm tracking-widest font-serif">RETREAT</span></button>
                    <div class="flex items-center gap-2 text-xs text-gray-500 uppercase tracking-[0.2em]">
                        <span class="w-1.5 h-1.5 rounded-full bg-red-600 animate-pulse"></span>Final
                        Phase: Karma
                    </div>
                </div>
                <!-- Boss Health & Name -->
                <div class="flex flex-col items-center flex-1 max-w-4xl mx-auto pt-2 pointer-events-auto">
                    <div class="w-full relative group">
                        <div class="absolute -top-6 left-0 w-full flex justify-between items-end px-2">
                            <div class="flex items-center gap-3"><span
                                    class="material-symbols-outlined text-purple-400">skull</span>
                                <h1
                                    class="text-3xl font-serif font-black text-white tracking-[0.2em] text-shadow-glow drop-shadow-md leading-none">
                                    魔尊 · 洛冰河</h1>
                            </div>
                            <div class="text-sm text-gray-400 font-mono tracking-wider">
                                HP: <span id="txt-boss-health" class="text-red-400 font-bold text-lg">---</span>/ 10000
                            </div>
                        </div>
                        <div
                            class="h-6 w-full bg-gray-900 border border-gray-600 relative overflow-hidden shadow-[0_0_20px_rgba(0,0,0,0.8)] mt-2">
                            <div class="absolute -top-4 left-1/2 -translate-x-1/2 w-[101%] h-12 bg-contain bg-center bg-no-repeat opacity-60 z-20 pointer-events-none"
                                style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuADL_kSEAdbUqD8SsLTrQe-nF1FQNqhLbBUPShvRqCcwht7EO-XV_2FL5BG5dlzpkYTOi88tS8EVqgt6TCUiq0lLtMvS0EvbMt2ahNMaB31uo6P0fNFe8XGMD4MKYtMIGosxpImtXfAUhsgutSNQUD7UnTtYnEVclywE_n81WXpt8RVhGGUemwwSNxNgupVjW2huTgYnYaXM5n6yYLJgYUjHB4tALFIAt0xDsvrFkedyBHgEVngWSH_QvuRh216rtc5sAxAOutOIXU'); filter: invert(1);">
                            </div>
                            <div class="absolute inset-0 bg-red-950"></div>
                            <div
                                class="absolute inset-0 bg-gradient-to-r from-purple-900 via-red-700 to-red-600 w-[85%] shadow-[0_0_15px_rgba(220,38,38,0.8)]">
                                <div class="absolute right-0 top-0 bottom-0 w-1 bg-white/40 animate-pulse">
                                </div>
                            </div>
                            <div class="absolute inset-0 flex">
                                <div class="flex-1 border-r border-black/20"></div>
                                <div class="flex-1 border-r border-black/20"></div>
                                <div class="flex-1 border-r border-black/20"></div>
                                <div class="flex-1 border-r border-black/20"></div>
                                <div class="flex-1 border-r border-black/20"></div>
                            </div>
                        </div>
                        <div class="flex justify-center gap-2 mt-2">
                            <div
                                class="px-2 py-0.5 rounded bg-purple-900/60 border border-purple-500/50 flex items-center gap-1">
                                <span
                                    class="material-symbols-outlined text-[14px] text-purple-200">dark_mode</span><span
                                    class="text-[10px] text-purple-100 font-serif">心魔引</span>
                            </div>
                            <div
                                class="px-2 py-0.5 rounded bg-gray-800/60 border border-gray-600/50 flex items-center gap-1">
                                <span class="material-symbols-outlined text-[14px] text-gray-300">shield</span><span
                                    class="text-[10px] text-gray-300 font-serif">金身不破</span>
                            </div>
                            <div
                                class="px-2 py-0.5 rounded bg-red-900/60 border border-red-500/50 flex items-center gap-1 animate-pulse">
                                <span
                                    class="material-symbols-outlined text-[14px] text-red-200">local_fire_department</span><span
                                    class="text-[10px] text-red-100 font-serif">暴怒</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex flex-col items-end pointer-events-auto"><button
                        class="p-2 rounded-full hover:bg-white/10 transition-colors"><span
                            class="material-symbols-outlined text-white/80">settings</span></button>
                </div>
            </div>
            <!-- Visual Space -->
            <div class="relative h-[55%] w-full overflow-hidden bg-[#1a0520] flex items-center justify-center">
                <div class="absolute inset-0 bg-cover bg-center opacity-60 mix-blend-overlay"
                    style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuBQQ_lbxyx_Zk--HbLInCVo85joBcchDLUHJv041vb_2VmkdDBQUi2EcFBrgcaCwPlnJYjuYEA9bJY5Ty2aiABbDm8K8d0gephDvXtqQH3q9ee0WLUwVpKbMPNGELMvPIIb3xMoxkM94_TVZJm9dqLCsw-deFnLNgfMGuZeef0Ey0-lRWw0ecfhHLVBxHnGg9oYQaXKnbHYsvqJBod4F6FtQQikZ7KDErXKd8VsmqELpyP5wT6R1Lssx0vPHLOBNhLEWvSkCRQzPAw');">
                </div>
                <div class="absolute inset-0 bg-gradient-to-b from-black/40 via-purple-900/10 to-black/90">
                </div>
                <!-- Boss Sprite -->
                <div class="relative w-full h-full max-w-4xl flex items-center justify-center translate-y-8">
                    <div class="w-full h-full bg-contain bg-no-repeat bg-bottom scale-125 transition-transform duration-[10s] ease-in-out hover:scale-130"
                        style="background-image: linear-gradient(0deg, rgba(10,10,12,1) 0%, rgba(0,0,0,0) 20%), url('https://lh3.googleusercontent.com/aida-public/AB6AXuBiulYyGnzenLAKxpbt5hqabWq7ttwqVvwfDcBCxTpI7g2wf6-lckdFpoIhmIwvKZubf5tTKtiqNBLzQfGdJMtlo6fPBosn-c5Afi_nPucfxU9DJ_rxIy4NPxB5Ze-TRP4kKo-2Hm97DjzD1yaMV-DlJvbnFztw7A5p_zWylBh6Piv2Osru6HIrzbv1268HSMaHUIuuBTEoZz9p-enZbqtM9RPZjpdVoxWNl83CVaIdDkJG8_eHPsVizlRR6a-LyUU214SpcgW513E'); filter: contrast(1.2) sepia(0.3) hue-rotate(250deg) saturate(1.4);">
                    </div>
                    <!-- Decorative Eyes -->
                    <div
                        class="absolute top-[40%] left-1/2 -translate-x-1/2 w-32 flex justify-center gap-12 opacity-90 animate-pulse">
                        <div class="w-3 h-3 rounded-full bg-red-500 shadow-[0_0_25px_8px_rgba(220,38,38,0.9)]">
                        </div>
                        <div class="w-3 h-3 rounded-full bg-red-500 shadow-[0_0_25px_8px_rgba(220,38,38,0.9)]">
                        </div>
                    </div>
                </div>
                <!-- Damage Numbers (Dynamic) -->
                <div id="boss-damage-display"
                    class="absolute top-1/2 left-[55%] -translate-y-24 pointer-events-none opacity-0"
                    style="transition: opacity 0.3s;"><span id="boss-damage-text"
                        class="text-boss-primary font-bold text-5xl font-display text-shadow-glow italic"></span></div>
            </div>
            <!-- Barrier/Seal Visual -->
            <div class="relative z-20 h-2 w-full flex items-center justify-center">
                <div
                    class="absolute inset-x-0 top-1/2 -translate-y-1/2 h-[4px] bg-boss-primary animate-barrier blur-[2px]">
                </div>
                <div class="absolute inset-x-0 top-1/2 -translate-y-1/2 h-[2px] bg-white mix-blend-overlay">
                </div>
                <div
                    class="relative w-24 h-24 -mt-1 rounded-full bg-black/60 border-2 border-boss-primary/50 flex items-center justify-center backdrop-blur-md shadow-glow-gold z-30">
                    <div
                        class="absolute inset-0 rounded-full border-2 border-boss-primary opacity-60 animate-[spin_12s_linear_infinite]">
                    </div>
                    <div
                        class="absolute inset-2 rounded-full border border-boss-primary/30 border-dashed animate-[spin_8s_linear_infinite_reverse]">
                    </div>
                    <div
                        class="w-16 h-16 rounded-full border border-boss-primary/30 flex items-center justify-center bg-black/40">
                        <span class="material-symbols-outlined text-boss-primary text-4xl animate-pulse">lock</span>
                    </div>
                </div>
                <!-- Seal Text -->
                <div
                    class="absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-[200px] text-xl text-boss-primary/80 font-serif tracking-[1em] opacity-80 whitespace-nowrap hidden md:block">
                    金光屏障 </div>
                <div
                    class="absolute top-1/2 -translate-y-1/2 right-1/2 translate-x-[200px] text-xl text-boss-primary/80 font-serif tracking-[1em] opacity-80 whitespace-nowrap text-right hidden md:block">
                    SEAL ACTIVE </div>
            </div>
            <!-- Bottom Controls -->
            <div class="relative h-[45%] w-full bg-[#121214] flex flex-col justify-end">
                <div class="absolute inset-0 opacity-40 pointer-events-none bg-repeat mix-blend-soft-light"
                    style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuDKInyyU8oRwPZe8srXXYtkrGXJ9vZCngVSwKTL7Qj3P_XO7oo8Qp3Y-7YJnAT5dxQ6ACot8AD4N-9VGyZlez_o4qbLTrlQdSfCB-MUUD__4n_kBBus0d7briY0lYAzCZ_PzGSa1np0OjqX4NeAiZ1UQXSvVUoXNUuYHY1n4gJFMJ4Cy4kqYqj4ZQlfo8gzOg1lxy1L0KAkpilkHZdB31L8Cm53tYExr3K5Kb5l4XVYidTVeoO_GdSF746YAYHwtRbeG2CVHv9sOt8');">
                </div>
                <div class="absolute inset-0 bg-gradient-to-t from-black/95 via-[#1a0f0f]/60 to-transparent">
                </div>
                <!-- Battle Log Area - Dynamic -->
                <div class="relative z-30 w-full px-4 md:px-[300px] mb-4 flex justify-center">
                    <div class="w-full max-w-6xl bg-gradient-to-r from-transparent via-[#1c1917]/90 to-transparent border-y border-white/10 backdrop-blur-sm py-3 px-8 font-serif shadow-lg max-h-40 overflow-y-auto custom-scrollbar"
                        id="boss-log-container">
                        <div
                            class="flex items-center gap-4 mb-2 sticky top-0 bg-[#1c1917]/95 py-1 -mx-2 px-2 z-10 border-b border-white/5">
                            <span
                                class="text-[10px] tracking-widest uppercase text-boss-primary/70 border border-boss-primary/20 px-2 py-0.5 bg-black/40 shrink-0">战斗日志</span>
                            <div class="h-px flex-1 bg-white/10"></div>
                        </div>
                        <div id="boss-log-entries" class="flex flex-col gap-2">
                            <div class="text-gray-300 text-sm tracking-wide">战场寂静，杀机暗藏...</div>
                        </div>
                    </div>
                </div>
                <!-- Three Main Buttons -->
                <div
                    class="relative z-40 w-full px-4 md:px-[320px] pb-12 flex items-end justify-between gap-6 max-w-[1920px] mx-auto">
                    <!-- BUTTON 1: BLOOD SACRIFICE (Red) --><button id="btn-boss-sacrifice"
                        class="group relative flex-1 h-24 bg-[#1a0505] border border-red-900/40 hover:border-red-500/80 transition-all duration-500 flex items-center justify-between px-8 overflow-hidden rounded-sm shadow-[0_10px_30px_-10px_rgba(0,0,0,0.8)]">
                        <div class="absolute inset-0 bg-gradient-to-r from-red-950/90 to-[#2a0505]/60 opacity-80">
                        </div>
                        <div
                            class="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/dark-matter.png')]">
                        </div>
                        <div class="relative z-10 flex items-center gap-5">
                            <div
                                class="w-14 h-14 rounded bg-red-900/20 border border-red-500/30 flex items-center justify-center group-hover:bg-red-600/20 group-hover:border-red-400 transition-all shadow-[0_0_15px_rgba(220,38,38,0.2)]">
                                <span
                                    class="material-symbols-outlined text-red-500 group-hover:text-red-200 text-3xl transition-colors">bloodtype</span>
                            </div>
                            <div class="text-left">
                                <!-- Dynamic JS will inject text
                                                                                        here usually, but static
                                                                                        structure helps --><span
                                    class="block text-2xl font-serif text-red-100/90 tracking-[0.25em] font-bold group-hover:text-white group-hover:text-shadow-glow transition-all">血祭</span><span
                                    class="text-[10px] text-red-500/60 uppercase tracking-widest group-hover:text-red-400 font-mono">Blood
                                    Sacrifice</span>
                            </div>
                        </div>
                    </button>
                    <!-- BUTTON 2: RESONANCE (Center/Gold) -->
                    <button id="btn-boss-union"
                        class="group relative w-[480px] h-36 -mb-4 bg-[#1a1505] border-x border-t border-yellow-600/30 hover:border-yellow-400/80 transition-all duration-500 flex flex-col items-center justify-center overflow-hidden rounded-t-xl shadow-[0_0_50px_rgba(242,185,13,0.1)] hover:shadow-[0_0_80px_rgba(242,185,13,0.25)] z-50">
                        <div class="absolute inset-0 bg-gradient-to-b from-[#2e2406] to-black opacity-90">
                        </div>
                        <div
                            class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/black-scales.png')] opacity-30 mix-blend-overlay">
                        </div>
                        <div
                            class="absolute bottom-0 left-0 right-0 h-1/2 bg-gradient-to-t from-boss-primary/10 to-transparent animate-pulse">
                        </div>
                        <div
                            class="relative z-10 flex flex-col items-center gap-2 group-hover:-translate-y-1 transition-transform">
                            <div class="flex items-center gap-4 mb-1">
                                <span class="h-px w-16 bg-gradient-to-r from-transparent to-boss-primary/60"></span>
                                <div class="relative"><span
                                        class="absolute inset-0 bg-boss-primary blur-lg opacity-20 animate-pulse"></span><span
                                        class="material-symbols-outlined text-5xl text-boss-primary drop-shadow-lg group-hover:text-white transition-colors relative z-10">balance</span>
                                </div><span
                                    class="h-px w-16 bg-gradient-to-l from-transparent to-boss-primary/60"></span>
                            </div><span
                                class="text-3xl font-serif text-boss-primary font-black tracking-[0.4em] text-shadow-glow group-hover:text-white transition-colors">双魂共鸣</span><span
                                class="text-xs text-yellow-500/50 font-mono tracking-[0.5em] mt-1 group-hover:text-yellow-200 uppercase">Resonance</span>
                        </div>
                        <div
                            class="absolute top-3 left-3 w-3 h-3 border-t-2 border-l-2 border-boss-primary/40 group-hover:border-boss-primary/80 transition-colors">
                        </div>
                        <div
                            class="absolute top-3 right-3 w-3 h-3 border-t-2 border-r-2 border-boss-primary/40 group-hover:border-boss-primary/80 transition-colors">
                        </div>
                    </button>
                    <!-- BUTTON 3: SPIRITUAL AID (Right/Cyan) -
                                                                                Mapped to btn-boss-finish in logic -->
                    <button id="btn-boss-finish"
                        class="group relative flex-1 h-24 bg-[#05131a] border border-cyan-900/40 hover:border-cyan-500/80 transition-all duration-500 flex items-center justify-between px-8 overflow-hidden rounded-sm shadow-[0_10px_30px_-10px_rgba(0,0,0,0.8)] flex-row-reverse">
                        <div class="absolute inset-0 bg-gradient-to-l from-cyan-950/90 to-[#051015]/60 opacity-80">
                        </div>
                        <div
                            class="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/dark-matter.png')]">
                        </div>
                        <div class="relative z-10 flex flex-row-reverse items-center gap-5">
                            <div
                                class="w-14 h-14 rounded bg-cyan-900/20 border border-cyan-500/30 flex items-center justify-center group-hover:bg-cyan-600/20 group-hover:border-cyan-400 transition-all shadow-[0_0_15px_rgba(8,145,178,0.2)]">
                                <span
                                    class="material-symbols-outlined text-cyan-500 group-hover:text-cyan-200 text-3xl transition-colors">spa</span>
                            </div>
                            <div class="text-right"><span
                                    class="block text-2xl font-serif text-cyan-100/90 tracking-[0.25em] font-bold group-hover:text-white group-hover:text-shadow-glow transition-all">灵力支撑</span><span
                                    class="text-[10px] text-cyan-500/60 uppercase tracking-widest group-hover:text-cyan-400 font-mono">Spiritual
                                    Aid</span></div>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- SCREEN 4: ENDING (NEUTRAL) -->
    <div id="screen-ending-ne" style="display: none;"
        class="fixed inset-0 z-[70] bg-black text-white flex flex-col items-center justify-center overflow-hidden">
        <div class="absolute inset-0 z-0">
            <div class="absolute inset-0 bg-cover bg-center bg-no-repeat transform scale-105 transition-transform duration-[30s]"
                style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuA4lTVXPcPP7faDHcpeXd_1ZTSUfNdR0VLCtLTu2LhymJixhNka7q61yYtAhXerGvLvm31yxa6fQyUTXxtQn3l5KLkM5NlKneP4WQy9_qrToT0GyHbedTTsBWYIQR3GJsd2siF30inte2dorRZbBudiO8m9m5b1pzKHek6QccUL2nGhRZsrQiCQUXBXDfVgo6akvf79do7zzjbevKJ-FwiiIjv9-2sqlRNIhRGEhdKTU8nT4OwDUBcVvmO0qJNBFTBadP_6LNsez4c");'>
            </div>
            <div class="absolute inset-x-0 bottom-0 h-3/4 bg-gradient-to-t from-black via-black/50 to-transparent">
            </div>
            <div class="absolute inset-y-0 right-0 w-1/2 bg-gradient-to-l from-black/80 via-black/20 to-transparent">
            </div>
            <div class="absolute inset-0 bg-orange-900/10 mix-blend-overlay pointer-events-none"></div>
        </div>
        <div class="relative z-10 w-full h-full flex flex-col justify-end items-center pb-12 lg:pb-16">
            <div class="absolute top-[12%] right-[8%] lg:right-[12%] flex flex-col items-center gap-6 opacity-0 animate-fade-in"
                style="animation-delay: 200ms;">
                <div
                    class="w-14 h-14 border border-red-800/60 bg-red-900/80 shadow-lg rotate-3 flex items-center justify-center backdrop-blur-sm rounded-sm">
                    <span
                        class="writing-vertical text-red-100 text-xs font-serif font-bold leading-none tracking-widest opacity-90">岁月<br />静好
                    </span>
                </div>
                <h1 id="txt-ending-title-ne"
                    class="writing-vertical font-calligraphy text-7xl lg:text-8xl text-transparent bg-clip-text bg-gradient-to-b from-white via-stone-200 to-stone-400 drop-shadow-2xl tracking-widest py-2 leading-tight">
                    退隐江湖 </h1>
            </div>
            <div class="flex flex-col items-center max-w-4xl text-center space-y-12 opacity-0 animate-fade-in"
                style="animation-delay: 600ms;">
                <div class="space-y-5 px-6">
                    <div class="flex items-center justify-center gap-4 mb-3 opacity-90">
                        <div class="h-px w-16 bg-gradient-to-r from-transparent to-primary"></div><span
                            id="txt-ending-label-ne"
                            class="text-primary font-serif font-bold tracking-[0.3em] text-xs lg:text-sm uppercase text-shadow-sm">Normal
                            End</span>
                        <div class="h-px w-16 bg-gradient-to-l from-transparent to-primary"></div>
                    </div>
                    <p
                        class="text-stone-200 text-lg lg:text-xl font-serif font-light leading-relaxed text-shadow-md max-w-2xl mx-auto tracking-wide">
                        虽身负重伤，风波终已平息。远离宗门恩怨，终得一片宁静。<br />红线虽染血，却系得更紧了。 </p>
                    <p class="text-white/50 text-sm font-serif italic mt-2 tracking-wider">
                        "此生不再问剑，只愿共看夕阳。"
                    </p>
                </div><button id="btn-restart-ne"
                    class="group relative min-w-[260px] px-8 py-4 bg-gradient-to-b from-stone-700 via-stone-800 to-black border-t border-stone-500/40 border-b border-black/80 shadow-[0_20px_40px_-10px_rgba(0,0,0,0.8)] hover:shadow-[0_0_25px_rgba(255,255,255,0.1)] hover:-translate-y-0.5 active:translate-y-0 active:scale-[0.99] transition-all duration-300 rounded-[2px] overflow-hidden">
                    <div
                        class="absolute inset-0 opacity-10 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0IiBoZWlnaHQ9IjQiPgo8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSI0IiBmaWxsPSIjZmZmIi8+CjxyZWN0IHdpZHRoPSIxIiBoZWlnaHQ9IjEiIGZpbGw9IiMwMDAiLz4KPC9zdmc+')] mix-blend-overlay">
                    </div>
                    <div
                        class="absolute inset-0 w-full h-full bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full animate-sheen pointer-events-none">
                    </div>
                    <div class="relative z-10 flex items-center justify-center gap-3"><span
                            class="material-symbols-outlined text-stone-400 group-hover:text-stone-200 transition-colors duration-300">keyboard_return
                        </span><span
                            class="font-serif text-stone-300 text-lg tracking-[0.3em] font-medium group-hover:text-white transition-colors duration-300">返回标题
                        </span></div>
                </button>
            </div>
        </div>
    </div>
    <!-- SCREEN 5: ENDING (BAD) -->
    <div id="screen-ending-be" style="display: none;"
        class="fixed inset-0 z-[70] bg-black text-white flex flex-col items-center justify-center overflow-hidden">
        <div
            class="relative w-full aspect-video max-h-screen bg-[#0f0a0a] shadow-2xl overflow-hidden isolate border-y border-white/5">
            <div class="absolute inset-0 z-0">
                <div class="absolute inset-0 bg-cover bg-center scale-105 transition-transform duration-[60s] hover:scale-100 ease-out"
                    style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuBqJ80owxopziZnORHqPT_bEkZn_8X5iBkhssGtLgsm9WkEDCI_1lhDpe-kfVjgtPadf9cGqEMGfhzXqOZCAjASC3CGdyLStGOyFGVxoDAHPuzm-j5OpUU5vLbbDkBqtOw9woVkpoqM5kymTOvAdz3Ibv7VosRsTqNgrBjhfuw2y2nseIjKEnpfjov--rJnh6NGpjVxdqcpHhE_Lkx0dFMp8GMJ3audirunL6F9FpOnoal29MTo9EuTwfYGXTefp-1QrXAr2PSZ3N4');">
                </div>
                <div class="absolute inset-0 bg-black/30 mix-blend-multiply"></div>
                <div class="absolute inset-0 bg-vignette-radial opacity-90"></div>
                <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-black/60 opacity-80">
                </div>
            </div>
            <div
                class="absolute inset-0 z-10 pointer-events-none mix-blend-overlay opacity-30 bg-[url('https://placeholder.pics/svg/1000x1000/222222/222222')]">
            </div>
            <div class="absolute top-1/4 left-1/4 w-1/2 h-1/2 blood-fog z-10 animate-pulse duration-[4000ms]">
            </div>
            <div class="absolute inset-0 z-20 flex flex-col items-center justify-between py-12 px-8">
                <div class="flex flex-col items-center gap-1 opacity-70">
                    <div
                        class="flex items-center gap-2 text-red-500/80 tracking-[0.3em] text-xs font-bold uppercase border border-red-900/30 bg-black/40 px-3 py-1 rounded-sm backdrop-blur-sm">
                        <span class="material-symbols-outlined text-sm">broken_image</span>Bad
                        Ending
                    </div>
                </div>
                <div class="flex-1 flex items-center justify-center w-full relative">
                    <div class="absolute w-64 h-64 bg-red-900/20 rounded-full blur-[80px]"></div>
                    <h1
                        class="relative font-serif text-7xl md:text-8xl lg:text-9xl font-black text-transparent bg-clip-text bg-gradient-to-b from-[#ff4d4d] via-[#b91c1c] to-[#450a0a] tracking-widest leading-none text-calligraphy drop-shadow-2xl transform scale-y-110">
                        万箭穿心 </h1>
                    <div
                        class="absolute -left-8 md:-left-16 h-32 w-[1px] bg-gradient-to-b from-transparent via-red-800 to-transparent opacity-50">
                    </div>
                    <div
                        class="absolute -right-8 md:-right-16 h-32 w-[1px] bg-gradient-to-b from-transparent via-red-800 to-transparent opacity-50">
                    </div>
                </div>
                <div class="mb-4 md:mb-8"><button id="btn-restart-be"
                        class="group relative min-w-[200px] h-14 flex items-center justify-center gap-3 bg-stone-surface border border-stone-highlight hover:border-red-800 transition-all duration-300 shadow-lg hover:shadow-glow-red overflow-hidden">
                        <div class="absolute inset-0 bg-metal-gradient opacity-90"></div>
                        <div
                            class="absolute inset-0 bg-[url('https://placeholder.pics/svg/100')] opacity-10 mix-blend-overlay">
                        </div>
                        <div
                            class="absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700 ease-in-out">
                        </div><span
                            class="material-symbols-outlined relative z-10 text-stone-400 group-hover:text-red-500 transition-colors text-xl">home</span><span
                            class="relative z-10 font-serif text-stone-300 font-bold tracking-[0.2em] text-lg group-hover:text-white transition-colors">返回标题
                        </span>
                        <div
                            class="absolute top-0 left-0 w-1.5 h-1.5 border-t border-l border-stone-500 group-hover:border-red-500 transition-colors">
                        </div>
                        <div
                            class="absolute top-0 right-0 w-1.5 h-1.5 border-t border-r border-stone-500 group-hover:border-red-500 transition-colors">
                        </div>
                        <div
                            class="absolute bottom-0 left-0 w-1.5 h-1.5 border-b border-l border-stone-500 group-hover:border-red-500 transition-colors">
                        </div>
                        <div
                            class="absolute bottom-0 right-0 w-1.5 h-1.5 border-b border-r border-stone-500 group-hover:border-red-500 transition-colors">
                        </div>
                    </button></div>
            </div>
        </div>
    </div>
    <script> // Game State

        const defaultState = {
            turnCount: 1,
            maxTurns: 30,
            yueHealth: 100, // Life Force
            yuePower: 50, // Combat Power
            shenPower: 50, // Combat Power
            bondValue: 0,
            hasActed: false, // Turn Lock
            isRelationshipUnlocked: false, // New Unlock State
            isBossBattle: false
        };

        let state = { ...defaultState };

        ;

        // DOM Elements
        const screens = {
            start: document.getElementById('screen-start'),
            main: document.getElementById('screen-main'),
            memory: document.getElementById('screen-memory'),
            boss: document.getElementById('screen-boss'),
            endingNE: document.getElementById('screen-ending-ne'),
            endingBE: document.getElementById('screen-ending-be')
        }

            ;

        const ui = {
            turn: document.getElementById('turn-count-display'),
            yuePowerText: document.getElementById('yue-power-display'),
            yueHealthBar: document.getElementById('health-bar'),
            shenPowerText: document.getElementById('shen-power-display'),
            shenBondBar: document.getElementById('bond-bar'),
            bondCenterText: document.getElementById('bond-center-display'),
            // Red String Elements
            redStringPath: document.getElementById('red-string-main'),
            redStringKnot: document.getElementById('red-string-knot'),

            log: document.getElementById('log-container'),
            bossHp: document.getElementById('txt-boss-health'),
            phaseText: document.getElementById('phase-display'),
            // Boss battle UI elements
            bossYueHealthBar: document.getElementById('boss-yue-health-bar'),
            bossShenPowerBar: document.getElementById('boss-shen-power-bar'),
            bossShenBondBar: document.getElementById('boss-shen-bond-bar'), // Logic update: Fatigue -> Bond
            bossDamageDisplay: document.getElementById('boss-damage-display'),
            bossDamageText: document.getElementById('boss-damage-text'),
            bossLogEntries: document.getElementById('boss-log-entries'),
            bossLogContainer: document.getElementById('boss-log-container'),
        }

            ;

        const btns = {
            cultivate: document.getElementById('btn-cultivate'), // Yue Cultivate
            shenCultivate: document.getElementById('btn-shen-cultivate'), // Shen Cultivate
            interact: document.getElementById('btn-interact'), // Explain/Interact
            rest: document.getElementById('btn-rest'), // Next Turn
            save: document.getElementById('btn-save'), // Manual Save

            recall: document.getElementById('btn-memory-recall'),
            forget: document.getElementById('btn-memory-forget'),
            bossSacrifice: document.getElementById('btn-boss-sacrifice'),
            bossUnion: document.getElementById('btn-boss-union'),
            bossFinish: document.getElementById('btn-boss-finish'),
            restartNE: document.getElementById('btn-restart-ne'),
            restartBE: document.getElementById('btn-restart-be')
        }

            ;

        // Helper Functions
        function showScreen(screenId) {
            Object.values(screens).forEach(el => { if (el) el.style.display = 'none'; });
            if (screenId === 'screen-start' && screens.start) screens.start.style.display = 'flex';
            else if (screenId === 'screen-main' && screens.main) screens.main.style.display = 'flex';
            else if (screenId === 'screen-memory' && screens.memory) screens.memory.style.display = 'flex';
            else if (screenId === 'screen-boss' && screens.boss) screens.boss.style.display = 'flex';
            else if (screenId === 'screen-ending-ne' && screens.endingNE) screens.endingNE.style.display = 'flex';
            else if (screenId === 'screen-ending-be' && screens.endingBE) screens.endingBE.style.display = 'flex';
        }

        function updateUI() {
            if (ui.turn) ui.turn.textContent = state.turnCount;

            const visualHp = Math.max(0, state.yueHealth);
            const visualBond = Math.min(100, Math.max(0, state.bondValue));
            const yuePwr = state.yuePower.toLocaleString();
            const shenPwr = state.shenPower.toLocaleString();

            if (ui.yuePowerText) ui.yuePowerText.textContent = yuePwr;
            if (ui.yueHealthBar) ui.yueHealthBar.style.width = visualHp + '%';

            if (ui.shenPowerText) ui.shenPowerText.textContent = shenPwr;
            if (ui.shenBondBar) ui.shenBondBar.style.width = visualBond + '%';
            if (ui.bondCenterText) ui.bondCenterText.textContent = state.bondValue;

            // Red String Visual State Logic
            if (ui.redStringPath && ui.redStringKnot) {
                if (state.bondValue < 40) {
                    // Broken State: Continuous from top/bottom but gap in center
                    // Top segment: 0 to 360 | Bottom segment: 440 to 800
                    ui.redStringPath.setAttribute('d', 'M 50 0 L 50 350 M 50 450 L 50 800');
                    ui.redStringPath.setAttribute('stroke-width', '2');
                    ui.redStringPath.style.opacity = '0.7';
                    // Ensure dashed array is removed/reset so it's not "intermittent" style
                    ui.redStringPath.style.strokeDasharray = 'none';
                    ui.redStringKnot.style.opacity = '0';
                }
                else if (state.bondValue < 80) {
                    // Thin Connection State
                    ui.redStringPath.setAttribute('d', 'M 50 0 L 50 800'); // Straight, simple line
                    ui.redStringPath.setAttribute('stroke-width', '1'); // Thin
                    ui.redStringPath.style.opacity = '0.8';
                    ui.redStringKnot.style.opacity = '0';
                }
                else {
                    // Complete State (Original)
                    ui.redStringPath.setAttribute('d', 'M 50 0 L 50 320C 50 350, 20 360, 40 390C 60 410, 50 400, 50 400C 50 400, 40 390, 60 410C 80 440, 50 450, 50 480L 50 800');
                    ui.redStringPath.setAttribute('stroke-width', '2.5');
                    ui.redStringPath.style.opacity = '1';
                    ui.redStringKnot.style.opacity = '1';
                }
            }

            // Button 3 : Dynamic Update
            if (state.isRelationshipUnlocked) {
                btns.interact.innerHTML = `<span class="material-symbols-outlined text-pink-400 group-hover:text-pink-600 transition-colors font-light text-xl">favorite</span>
                        <span class="text-xs font-serif text-pink-900/90 tracking-[0.2em] font-medium">共度</span>`;
                btns.interact.classList.add('btn-pink');
            } else {
                btns.interact.innerHTML = `<span class="material-symbols-outlined text-vermilion-thread/60 group-hover:text-ink-black transition-colors font-light text-xl">chat_bubble</span>
                        <span class="text-xs font-serif text-ink-black/90 tracking-[0.2em] font-medium">解释</span>`;
                btns.interact.classList.remove('btn-pink');
            }

            // Turn Lock Visuals
            const actionBtns = [btns.cultivate, btns.shenCultivate, btns.interact];

            if (state.hasActed) {
                // PHASE B: Action taken -> Disable Actions, Enable Next Day
                actionBtns.forEach(btn => {
                    if (btn) btn.disabled = true;
                });
                if (btns.rest) btns.rest.disabled = false;

                // Update Phase Text
                if (ui.phaseText) {
                    ui.phaseText.textContent = "戌时 · 休憩";
                    ui.phaseText.className = "text-xs font-serif font-bold tracking-widest text-ink-light/50";
                }
            } else {
                // PHASE A: New Day -> Enable Actions, Disable Next Day
                actionBtns.forEach(btn => {
                    if (btn) btn.disabled = false;
                });
                if (btns.rest) btns.rest.disabled = true;

                // Update Phase Text
                if (ui.phaseText) {
                    ui.phaseText.textContent = "辰时 · 筹备";
                    ui.phaseText.className = "text-xs font-serif font-bold tracking-widest text-vermilion-thread";
                }
            }

            if (state.yueHealth <= 0) {
                triggerEnding();
            }
        }

        function log(msg, type) {
            const div = document.createElement('div');
            // New UI Log Style
            div.className = "flex gap-4 items-start group opacity-80 hover:opacity-100 transition-opacity animate-fade-in";

            let label = '[系统]';
            // Adjusted styles for new theme
            let labelClass = "font-serif text-[10px] text-ink-light/60 mt-1.5 border border-ink-light/20 px-1.5 py-0.5 rounded-sm shrink-0 min-w-[3rem] text-center";

            if (type === 'action') {
                label = '[行动]';
                labelClass = "font-serif text-[10px] text-vermilion-thread font-medium mt-1.5 border border-vermilion-thread/20 px-1.5 py-0.5 rounded-sm bg-vermilion-thread/5 shrink-0 min-w-[3rem] text-center";
            }
            else if (type === 'story') {
                label = '[剧情]';
                labelClass = "font-serif text-[10px] text-mist-cyan font-medium mt-1.5 border border-mist-cyan/20 px-1.5 py-0.5 rounded-sm bg-mist-cyan/5 shrink-0 min-w-[3rem] text-center";
            }
            if (type === 'battle') {
                label = '[战斗]';
                labelClass = "font-serif text-[10px] text-red-800 font-medium mt-1.5 border border-red-800/20 px-1.5 py-0.5 rounded-sm bg-red-800/5 shrink-0 min-w-[3rem] text-center";

                // Add to boss log entries (multiple lines)
                if (ui.bossLogEntries) {
                    const logEntry = document.createElement('div');
                    logEntry.className = 'text-gray-300 text-sm tracking-wide animate-fade-in';
                    logEntry.textContent = msg;
                    ui.bossLogEntries.appendChild(logEntry);

                    // Scroll to bottom
                    if (ui.bossLogContainer) {
                        ui.bossLogContainer.scrollTop = ui.bossLogContainer.scrollHeight;
                    }
                }
            }

            div.innerHTML = `<span class="${labelClass}">${label}</span><p class="text-ink-light/90 leading-relaxed font-serif font-light text-[13px]">${msg}</p>`;

            if (ui.log) {
                ui.log.appendChild(div);
                ui.log.scrollTop = ui.log.scrollHeight;
            }
        }

        // --- DAILY ACTIONS ---

        function endPhase() {
            state.hasActed = true;
            saveGame('auto'); // Auto-save after action
            updateUI();
        }

        // Button 1: Yue Cultivate
        btns.cultivate.onclick = () => {
            if (state.hasActed) return;
            state.yuePower += 10;
            log("【玄肃剑主】岳清源闭关悟道，周身灵力流转。（岳清源战力 +10）", 'action');
            endPhase();
        }

            ;

        // Button 2: Shen Cultivate
        btns.shenCultivate.onclick = () => {
            if (state.hasActed) return;
            state.shenPower += 10;
            log("【修雅剑主】沈清秋在竹林演练剑法，剑意凌厉。（沈清秋战力 +10）", 'action');
            endPhase();
        }

            ;

        // Button 3: Interact (Dynamic)
        btns.interact.onclick = () => {
            if (state.hasActed) return;

            // Scenario A: Locked
            if (!state.isRelationshipUnlocked) {
                const rng = Math.random();

                if (rng < 0.4) {
                    // Success
                    state.isRelationshipUnlocked = true;
                    state.bondValue += 20;
                    log("【心结解开】岳清源终于将当年的真相和盘托出。沈清秋怔然良久，收起了折扇，眼角的戾气终于消散。（解释成功！关系进阶！）", 'story');
                }

                else {
                    // Failure
                    state.bondValue += 3;
                    log("【词不达意】岳清源笨嘴拙舌，沉默了半天只说出了对不起。沈清秋不耐烦地打断了他。（解释失败...）", 'story');
                }
            }

            // Scenario B: Unlocked (Romantic Events)
            else {
                const rng = Math.random();

                if (rng < 0.4) {
                    // 0 - 0.4 : Chess (40%)
                    state.bondValue += 8;
                    log("【闲敲棋子】竹舍幽静，二人对弈一局。不再是针锋相对，而是岁月静好。（羁绊 +8）", 'story');
                }

                else if (rng < 0.8) {
                    // 0.4 - 0.8 : Wine (40%)
                    state.bondValue += 10;
                    log("【把酒言欢】沈清秋拿出了珍藏的竹叶青。这一次，没有人再提过去的苦痛，只有眼前的温存。（羁绊 +10）", 'story');
                }

                else {
                    // 0.8 - 1.0 : Dual Cultivation (20%)
                    state.yueHealth = Math.min(100, state.yueHealth + 30);
                    state.yuePower += 15;
                    state.shenPower += 15;
                    state.bondValue += 15;
                    log("【灵犀双修】红帐暖香，二人灵肉合一。以名入剑的旧伤在沈清秋的灵力安抚下彻底平息……（七哥气血大回。两人战力和羁绊都暴涨♥）", 'story');
                }
            }

            endPhase(); // Trigger lock
        }

            ;

        // Random Event Logic
        function triggerRandomEvent() {
            const roll = Math.random(); // 0.0 to 1.0

            // 1. Peaceful Day (0% - 20%)
            if (roll < 0.2) {
                const peacefulLogs = ["【平安】今日苍穹山云雾缭绕，一切如常。",
                    "【宁静】清静峰的竹叶被风吹得沙沙作响，难得的宁静一日。",
                    "【无事】岁月静好，只有玄肃剑发出一声极轻的嗡鸣。"
                ];
                const randomText = peacefulLogs[Math.floor(Math.random() * peacefulLogs.length)];
                log(randomText, 'system');
            }

            // 2. Yue's Injury (20% - 40%)
            else if (roll < 0.4) {
                state.yuePower -= 5;
                log("【突发】深夜寒露重，岳清源旧伤隐隐作痛，灵力凝滞。（岳清源战力 -5）", 'story');
            }

            // 3. Rumors (40% - 60%)
            else if (roll < 0.6) {
                state.shenPower -= 5;
                log("【突发】闲言碎语传入清静峰，沈清秋面色阴沉，无心修炼。（沈清秋战力 -5）", 'story');
            }

            // 4. Heart Demon (60% - 80%)
            else if (roll < 0.8) {
                state.yuePower -= 3;
                state.shenPower -= 3;
                log("【突发】心魔如影随形，二人在修炼时皆感到一阵心悸。（双方战力各 -3）", 'story');
            }

            // 5. Sweet Memory (80% - 100%)
            else {
                state.bondValue += 5;
                log("【吉兆】沈清秋无意间翻出一张陈旧的字条，那是当年七哥留下的。神色稍缓。（羁绊 +5）", 'story');
            }

            updateUI();
        }

        // Button 4: Next Day
        btns.rest.onclick = () => {
            if (!state.hasActed) return; // Strict Turn Lock

            state.turnCount++;
            state.hasActed = false; // Reset lock for Phase A

            // Auto-Save on new day
            saveGame('auto');

            if (state.turnCount === 20) {
                triggerMemoryEvent();
            }
            else if (state.turnCount >= 30) {
                startBossBattle();
            }
            else {
                triggerRandomEvent();
                // Log after random event for better flow
                log("行动已结束，请点击【次日】推进时间。", 'system');
            }

            updateUI();
        }

            ;

        // --- EVENTS ---

        function triggerMemoryEvent() {
            log("【记忆触动】一段尘封的往事浮现在眼前...", 'story');
            setTimeout(() => showScreen('screen-memory'), 1000);
        }

        // --- START SCREEN & SAVE/LOAD SYSTEM ---
        const MANUAL_SAVE_KEY = 'fate_reincarnation_save_v1';
        const AUTO_SAVE_KEY = 'fate_reincarnation_autosave_v1';

        // Extended UI elements for Start Screen
        const startUI = {
            startBtn: document.getElementById('btn-start-game'),
            continueBtn: document.getElementById('btn-continue-game'),
            loadBtn: document.getElementById('btn-load-game'),
            log: document.getElementById('log-container')
        };

        function saveGame(type = 'auto') {
            const key = type === 'manual' ? MANUAL_SAVE_KEY : AUTO_SAVE_KEY;

            // Save current state + innerHTML of log
            const saveData = {
                state: state,
                logHTML: startUI.log.innerHTML,
                timestamp: new Date().getTime()
            };
            localStorage.setItem(key, JSON.stringify(saveData));

            if (type === 'auto') {
                console.log('Auto-saved state.');
            }
        }

        function loadGame(type = 'manual') {
            const key = type === 'manual' ? MANUAL_SAVE_KEY : AUTO_SAVE_KEY;
            const raw = localStorage.getItem(key);

            if (!raw) {
                alert(type === 'manual' ? "没有找到手动存档！" : "没有找到自动存档！");
                return;
            }
            try {
                const data = JSON.parse(raw);
                // Safe merge of state
                state = { ...defaultState, ...data.state };
                startUI.log.innerHTML = data.logHTML;

                // Switch screens
                showScreen('screen-main');
                // Force update UI logic
                setTimeout(() => updateUI(), 50);
                log(type === 'manual' ? "[系统] 读取手动存档成功。" : "[系统] 读取自动存档成功。", 'system');
            } catch (e) {
                console.error(e);
                alert("存档损坏！");
            }
        }

        // Hook up Start Screen Buttons
        if (startUI.startBtn) {
            startUI.startBtn.onclick = () => {
                // New Game - Reset State
                state = { ...defaultState };

                startUI.log.innerHTML = `<div class="flex gap-4 items-start"><span class="text-xs font-mono text-gray-600">[系统]</span><p class="text-base font-serif text-gray-800">欢迎来到宿命轮回。</p></div>`;

                // Initial Auto-save so they can continue if they quit immediately
                saveGame('auto');

                showScreen('screen-main');
                updateUI();
            };
        }

        if (startUI.continueBtn) {
            startUI.continueBtn.onclick = () => {
                loadGame('auto');
            };
        }

        if (startUI.loadBtn) {
            startUI.loadBtn.onclick = () => {
                loadGame('manual');
            };
        }

        // Manual Save Button Handler
        if (btns.save) {
            btns.save.onclick = () => {
                saveGame('manual');
                // Visual feedback
                const originalHTML = btns.save.innerHTML;
                btns.save.innerHTML = `<span class="material-symbols-outlined text-green-400 text-base">check_circle</span><span>已存档!</span>`;
                btns.save.classList.add('bg-green-900/30', 'border-green-600/40');
                btns.save.classList.remove('bg-amber-900/30', 'border-amber-600/40');

                setTimeout(() => {
                    btns.save.innerHTML = originalHTML;
                    btns.save.classList.remove('bg-green-900/30', 'border-green-600/40');
                    btns.save.classList.add('bg-amber-900/30', 'border-amber-600/40');
                }, 1500);

                log("【系统】游戏已手动存档。", 'system');
            };
        }

        // Helper Functions

        // Memory Screen Logic
        btns.recall.onclick = () => {
            state.bondValue += 20;
            log("【铭记于心】那些痛苦与温暖并存的记忆，让羁绊更加深刻。（羁绊 +20）", 'story');
            updateUI();
            showScreen('screen-main');
        };

        btns.forget.onclick = () => {
            state.yueHealth = Math.min(100, state.yueHealth + 20);
            log("【随风而去】放下了执念，心境反而开阔了许多。", 'story');
            updateUI();
            showScreen('screen-main');
        };

        // --- BOSS BATTLE ---

        let bossHP = 10000;

        function startBossBattle() {
            state.isBossBattle = true;
            bossHP = 10000; // Reset for safety
            log("【决战】第30天已至。魔尊洛冰河降临！", 'story');

            setTimeout(() => {
                showScreen('screen-boss');
                ui.bossHp.textContent = bossHP;
                updateBossButtons();
                updateBossUI(); // Initialize side panel stat bars
            }, 1000);
        }


        function updateBossButtons() {
            // Button A: Combined Strike (Center) - Replaces Union
            btns.bossUnion.innerHTML = `<span class="text-3xl font-serif text-yellow-500 font-black tracking-[0.2em] uppercase">双剑合璧</span><span class="text-xs text-yellow-500/50 font-mono tracking-[0.2em] mt-1">DMG: (战力)x3</span>`;

            // Button B: Support (Right) - Replaces BossButton 3
            btns.bossFinish.innerHTML = `<div class="text-center"><span class="block text-2xl font-serif font-bold text-cyan-500">清静灵阵</span><span class="text-[10px] text-cyan-500 uppercase">Heal Yue</span></div>`;

            // Button C: Ultimate (Left) - Replaces Sacrifice
            btns.bossSacrifice.innerHTML = `<div class="text-center"><span class="block text-2xl font-serif font-bold text-red-500">玄肃·绝杀</span><span class="text-[10px] text-red-500 uppercase">HP -30 | DMG 2500</span></div>`;
        }

        // Update Boss Battle Side Panels
        function updateBossUI() {
            // Calculate percentages for bars
            // Yue Health: Direct percentage (0-100)
            const yueHealthPercent = Math.max(0, state.yueHealth);
            // Shen Power: Based on shenPower, assuming max around 200 for visual purposes
            const shenPowerPercent = Math.min(100, Math.max(5, (state.shenPower / 200) * 100));
            // Bond: Direct percentage (0-100)
            const bondPercent = Math.min(100, Math.max(0, state.bondValue));

            if (ui.bossYueHealthBar) ui.bossYueHealthBar.style.height = yueHealthPercent + '%';
            if (ui.bossShenPowerBar) ui.bossShenPowerBar.style.height = shenPowerPercent + '%';
            if (ui.bossShenBondBar) ui.bossShenBondBar.style.height = bondPercent + '%';
        }

        // Show animated damage number
        function showDamageNumber(damage, isHeal = false) {
            if (!ui.bossDamageDisplay || !ui.bossDamageText) return;

            // Format damage with comma
            const formattedDmg = damage.toLocaleString();
            const prefix = isHeal ? '+' : '-';
            ui.bossDamageText.textContent = prefix + formattedDmg;

            // Set color based on heal or damage
            ui.bossDamageText.className = isHeal
                ? 'text-green-400 font-bold text-5xl font-display text-shadow-glow italic'
                : 'text-boss-primary font-bold text-5xl font-display text-shadow-glow italic';

            // Show the display
            ui.bossDamageDisplay.style.opacity = '1';
            ui.bossDamageDisplay.style.transform = 'translateY(-24px)';

            // Animate upward and fade out
            let opacity = 1;
            let translateY = -24;
            const animInterval = setInterval(() => {
                opacity -= 0.03;
                translateY -= 2;
                ui.bossDamageDisplay.style.opacity = opacity;
                ui.bossDamageDisplay.style.transform = `translateY(${translateY}px)`;

                if (opacity <= 0) {
                    clearInterval(animInterval);
                    ui.bossDamageDisplay.style.opacity = '0';
                    ui.bossDamageDisplay.style.transform = 'translateY(-24px)';
                }
            }, 30);
        }


        // Boss Actions

        function bossCounterAttack() {

            // Delay counter attack slightly for effect
            setTimeout(() => {
                if (bossHP <= 0) return; // Boss dead, no counter

                const dmg = 50;
                state.yueHealth -= dmg;
                log("洛冰河反手一击，心魔剑气直冲岳清源胸口！(岳清源 HP -50)", 'battle');
                updateUI();
                updateBossUI(); // Update side panel bars

                // Check Death (BE immediate trigger)
                if (state.yueHealth <= 0) {
                    triggerEnding();
                }
            }, 800);

            checkBattleEnd();
        }

        function checkBattleEnd() {
            if (bossHP <= 0) {
                bossHP = 0;
                ui.bossHp.textContent = 0;

                // Delay Victory Screen
                setTimeout(() => {
                    triggerEnding();
                }, 1500);
            }
        }


        // Button Handlers

        // 1. Combined Strike (Union)
        btns.bossUnion.onclick = () => {
            if (bossHP <= 0 || state.yueHealth <= 0) return;

            const dmg = (state.yuePower + state.shenPower) * 3;
            bossHP -= dmg;
            ui.bossHp.textContent = Math.max(0, bossHP);

            log(`【双剑合璧】二人默契配合，共同击出灵力暴击，击向洛冰河。（BOSS 受到 ${dmg} 点伤害）`, 'battle');
            showDamageNumber(dmg); // Show animated damage
            updateBossUI(); // Update side panel bars

            bossCounterAttack();
        };

        // 2. Shen Support (Finish Button Repurposed)
        btns.bossFinish.onclick = () => {
            if (bossHP <= 0 || state.yueHealth <= 0) return;

            const heal = Math.floor(state.shenPower * 0.8);
            state.yueHealth = Math.min(100, state.yueHealth + heal);

            log(`【清静灵阵】沈清秋展开灵阵护住岳清源心脉。（岳清源气血恢复 ${heal}）`, 'battle');
            showDamageNumber(heal, true); // Show animated heal number
            updateUI();
            updateBossUI(); // Update side panel bars
            bossCounterAttack();
        };

        // 3. Ultimate (Sacrifice)
        btns.bossSacrifice.onclick = () => {
            if (bossHP <= 0 || state.yueHealth <= 0) return;

            // Cost
            state.yueHealth -= 30;
            updateUI(); // Immediate update to show cost
            updateBossUI(); // Update side panel bars

            if (state.yueHealth <= 0) {
                log("【警告】岳清源强行拔出玄肃，寿元耗尽...", 'battle');
                triggerEnding();
                return;
            }

            const dmg = 2500;
            bossHP -= dmg;
            ui.bossHp.textContent = Math.max(0, bossHP);

            log("【玄肃·绝杀】岳清源强行拔出玄肃，寿元燃烧！惊天剑气斩给了洛冰河重重一击！(BOSS 受到 2500 伤害)", 'battle');
            showDamageNumber(dmg); // Show animated damage

            bossCounterAttack();
        };

        // --- ENDINGS ---
        function triggerEnding() {

            // 1. BAD ENDING
            if (state.yueHealth <= 0) {
                showScreen('screen-ending-be');
                return;
            }

            // 2. VICTORY CHECK (Boss Defeated)

            // Logic for HE vs NE
            // HE: Health >= 40 AND Bond >= 90
            // NE: Health < 40 (Alive but Crippled) OR Bond < 90 (Survived but drifted apart)

            const isHeConditionsMet = state.yueHealth >= 40 && state.bondValue >= 90;

            const endingTitle = document.getElementById('txt-ending-title-ne');

            // Note: We are reusing the NE screen element but injecting different text.
            // Ideally we should have separate HTML but this works for constraints.

            if (isHeConditionsMet) {
                // HAPPY ENDING
                if (endingTitle) endingTitle.textContent = "归隐山林";
                const endingLabel = document.getElementById('txt-ending-label-ne');
                if (endingLabel) endingLabel.textContent = "Happy End";

                showScreen('screen-ending-ne'); // Use same UI base
            }

            else {
                // NEUTRAL ENDING
                if (endingTitle) endingTitle.textContent = "退隐江湖";
                const endingLabel = document.getElementById('txt-ending-label-ne');
                if (endingLabel) endingLabel.textContent = "Normal End";
                showScreen('screen-ending-ne');
            }
        }

        btns.restartNE.onclick = () => showScreen('screen-start');
        btns.restartBE.onclick = () => showScreen('screen-start');

        // Check for auto-save on init
        function checkAutoSave() {
            const raw = localStorage.getItem(AUTO_SAVE_KEY);
            if (raw && startUI.continueBtn) {
                try {
                    JSON.parse(raw); // Check validity
                    startUI.continueBtn.disabled = false;
                    startUI.continueBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    startUI.continueBtn.querySelector('span:last-child').textContent = "继续前缘 (自动存档)";
                } catch (e) {
                    // Invalid
                    startUI.continueBtn.disabled = true;
                    startUI.continueBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    startUI.continueBtn.querySelector('span:last-child').textContent = "继续前缘 (无存档)";
                }
            } else if (startUI.continueBtn) {
                startUI.continueBtn.disabled = true;
                startUI.continueBtn.classList.add('opacity-50', 'cursor-not-allowed');
                startUI.continueBtn.querySelector('span:last-child').textContent = "继续前缘 (无存档)";
            }
        }

        // Init
        updateUI();
        checkAutoSave(); // Run check

        // Check for save on init but default to start screen
        showScreen('screen-start');
    </script>
</body>

</html>